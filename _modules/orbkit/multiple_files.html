

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>orbkit.multiple_files &mdash; ORBKIT  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/orbkit.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ORBKIT  documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> ORBKIT
          

          
          </a>

          
            
            
              <div class="version">
                v1.0 (stable)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general.html">General Aspects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gridbased/index.html">Grid-Based Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nongridbased/index.html">Non Grid-Based Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adtutorials/index.html">Advanced Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../detci/index.html">detCI&#64;ORBKIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refs/index.html">ORBKIT References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../literature/literature.html">Literature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../licence.html">Licence Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../impressum.html">Impressum - Legal Notice</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">ORBKIT</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>orbkit.multiple_files</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for orbkit.multiple_files</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: iso-8859-1 -*-</span>
<span class="sd">&#39;&#39;&#39;Module for processing multiple output files of quantum chemical software.</span>

<span class="sd">**Capabilities**</span>

<span class="sd">  - Read a list of files</span>
<span class="sd">  - Order the molecular orbital coefficients by using analytical integrals,</span>
<span class="sd">    by extrapolation, or by hand (e.g. for the preparation of an interpolation)</span>
<span class="sd">  - Save and read the information obtained to and from an HDF5-file</span>
<span class="sd">  - Depiction of molecular orbitals</span>

<span class="sd">Example for the Execution::</span>

<span class="sd">  # Create a list of input filenames</span>
<span class="sd">  fid_list = []</span>
<span class="sd">  for i in range(101):</span>
<span class="sd">    fid_list.append(&#39;~/molden_files/%03d.molden&#39; % i)</span>

<span class="sd">  init_display(name = &#39;MO_ordering&#39;)  # Specify a filename for the oklog file </span>
<span class="sd">                                      # (We want a oklog file but we have no </span>
<span class="sd">                                      # options.outputname here.)</span>

<span class="sd">  # Start reading and ordering routine.</span>
<span class="sd">  order_using_analytical_overlap(fid_list,itype=&#39;molden&#39;)</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="nn">orbkit.read</span> <span class="kn">import</span> <span class="n">main_read</span>
<span class="kn">from</span> <span class="nn">orbkit.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span><span class="n">init_display</span>
<span class="kn">from</span> <span class="nn">orbkit.analytical_integrals</span> <span class="kn">import</span> <span class="n">get_ao_overlap</span><span class="p">,</span> <span class="n">get_mo_overlap_matrix</span>

<span class="n">geo_spec_all</span>  <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: Contains all molecular geometries, i.e., :literal:`geo_spec`. (See :ref:`Central Variables` for details.)</span>
<span class="n">geo_info</span>      <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: See :ref:`Central Variables` for details.</span>
<span class="n">ao_spec</span>       <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: See :ref:`Central Variables` for details.</span>
<span class="n">ao_spherical</span>  <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: See :ref:`Central Variables` for details.</span>
<span class="n">mo_coeff_all</span>  <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: Contains all molecular orbital coefficients. List of numpy.ndarray</span>
<span class="n">mo_energy_all</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: Contains all molecular orbital energies. List of numpy.ndarray</span>
<span class="n">mo_occ_all</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: Contains all molecular orbital occupations. List of numpy.ndarray</span>
<span class="n">sym</span>           <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: Python dictionary containing the molecular orbital symmetries and the corresponding position in mo_coeff_all, mo_energy_all, and mo_occ_all, respectively.</span>
<span class="n">index_list</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: After the execution of the ordering routine, it contains the new indices of the molecular orbitals. If index &lt; 0, the molecular orbital changes its sign. shape=(Nfiles,NMO)</span>

<span class="n">geo_spec_tck</span>  <span class="o">=</span> <span class="p">[]</span>
<span class="n">mo_coeff_tck</span>  <span class="o">=</span> <span class="p">[]</span>
<span class="n">mo_energy_tck</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mo_occ_tck</span>    <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="read"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span><span class="n">itype</span><span class="o">=</span><span class="s1">&#39;molden&#39;</span><span class="p">,</span><span class="n">all_mo</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">nosym</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs_all</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Reads a list of input files.</span>
<span class="sd">  </span>
<span class="sd">  **Parameters:**</span>
<span class="sd">  </span>
<span class="sd">    fid_list : list of str</span>
<span class="sd">      List of input file names.</span>
<span class="sd">    itype : str, choices={&#39;molden&#39;, &#39;gamess&#39;, &#39;gaussian.log&#39;, &#39;gaussian.fchk&#39;}</span>
<span class="sd">        Specifies the type of the input files.</span>
<span class="sd">  </span>
<span class="sd">  **Global Variables:**</span>
<span class="sd">  </span>
<span class="sd">  geo_spec_all, geo_info, ao_spec, ao_spherical, mo_coeff_all, mo_energy_all, mo_occ_all, sym</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">global</span> <span class="n">geo_spec_all</span><span class="p">,</span> <span class="n">geo_info</span><span class="p">,</span> <span class="n">ao_spec</span><span class="p">,</span> <span class="n">ao_spherical</span><span class="p">,</span> <span class="n">mo_coeff_all</span><span class="p">,</span> <span class="n">mo_energy_all</span><span class="p">,</span> <span class="n">mo_occ_all</span><span class="p">,</span> <span class="n">sym</span>
  
  <span class="n">geo_spec_all</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">MO_Spec</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">mo_coeff_all</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">mo_energy_all</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">mo_occ_all</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1"># geo_info and ao_info have to stay unchanged</span>
  <span class="n">geo_old</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">ao_old</span> <span class="o">=</span> <span class="p">[]</span>
  
  <span class="n">sym_list</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">n_ao</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">n_r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fid_list</span><span class="p">)</span>
  
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fid_list</span><span class="p">):</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs_all</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;kwargs&#39;</span> <span class="ow">in</span> <span class="n">kwargs_all</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">kwargs_all</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">main_read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">,</span> <span class="n">all_mo</span><span class="o">=</span><span class="n">all_mo</span><span class="p">,</span><span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Geo Section</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">geo_old</span> <span class="o">!=</span> <span class="n">qc</span><span class="o">.</span><span class="n">geo_info</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;qc.geo_info has changed!&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">geo_old</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">geo_info</span><span class="p">)</span>
    <span class="n">geo_spec_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">geo_spec</span><span class="p">)</span>
    <span class="c1"># AO Section</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">alltrue</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">ao_old</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;coeffs&#39;</span><span class="p">],</span><span class="n">qc</span><span class="o">.</span><span class="n">ao_spec</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;coeffs&#39;</span><span class="p">])</span>
                      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ao_old</span><span class="p">))]</span>
                      <span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;qc.ao_spec has changed!&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ao_old</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">ao_spec</span><span class="p">)</span>
    <span class="c1"># MO Section</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="p">{}</span>    
    <span class="n">MO_Spec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">mo_spec</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">mo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">mo_spec</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">nosym</span><span class="p">:</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">mo_spec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.1&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">sym</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_ao</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">mo_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;coeffs&#39;</span><span class="p">])</span>
      <span class="n">sym</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">it</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sym_list</span><span class="p">:</span>
        <span class="n">sym_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sym_list</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">it</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">sym_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span>
  
  <span class="n">geo_spec_all</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">)</span>
  <span class="n">geo_info</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">geo_info</span>
  <span class="n">ao_spec</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">ao_spec</span>
  <span class="n">ao_spherical</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">ao_spherical</span>
  <span class="c1"># Presorting of the MOs according to their symmetry</span>
  
  <span class="n">sym</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">it</span> <span class="ow">in</span> <span class="n">sym_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">sym</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)))</span>
    <span class="n">mo_coeff_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_r</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">n_ao</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
    <span class="n">mo_energy_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_r</span><span class="p">,</span><span class="n">it</span><span class="p">)))</span>
    <span class="n">mo_occ_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_r</span><span class="p">,</span><span class="n">it</span><span class="p">)))</span>
  
  <span class="n">sym</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
  
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">spec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">MO_Spec</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">mo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spec</span><span class="p">):</span>
      <span class="n">index</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
      
      <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
      
      <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">sym</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s1">&#39;coeffs&#39;</span><span class="p">]</span>
      <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">sym</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>
      <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">sym</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">i</span><span class="p">,</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="s1">&#39;occ_num&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="get_extrapolation"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.get_extrapolation">[docs]</a><span class="k">def</span> <span class="nf">get_extrapolation</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">mo_coeff</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">grid1d</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Extrapolates the molecular orbital coefficients :literal:`mo_coeff` </span>
<span class="sd">  using a polynomial of degree :literal:`deg`.</span>
<span class="sd">  </span>
<span class="sd">  **Paramerters:**</span>
<span class="sd">  </span>
<span class="sd">  r1 : int</span>
<span class="sd">    Specifies the index of the last known molecular orbital.</span>
<span class="sd">  r2 : int</span>
<span class="sd">    Specifies the index to which the molecular orbital coefficients are </span>
<span class="sd">    extrapolated.</span>
<span class="sd">  deg : int</span>
<span class="sd">    Specifies the degree of the extrapolation polynomial.</span>
<span class="sd">  grid1d : list or numpy.1darray, optional</span>
<span class="sd">    Specifies the grid for the extrapolation.</span>
<span class="sd">  </span>
<span class="sd">  **Returns:**</span>
<span class="sd">  </span>
<span class="sd">  epol : numpy.ndarray, shape=(NMO,NAO))</span>
<span class="sd">    Contains the extrapolated molecular orbital coefficients.  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">grid1d</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">grid1d</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">r2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">deg</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">mo_coeff</span><span class="p">[</span><span class="n">r1</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">-</span> <span class="n">mo_coeff</span><span class="p">[</span><span class="n">r1</span><span class="p">,:,:])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">grid1d</span><span class="p">[</span><span class="n">r1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid1d</span><span class="p">[</span><span class="n">r1</span><span class="p">])</span>
    <span class="n">epol</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid1d</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span> <span class="o">-</span> <span class="n">grid1d</span><span class="p">[</span><span class="n">r1</span><span class="p">])</span> <span class="o">+</span> <span class="n">mo_coeff</span><span class="p">[</span><span class="n">r1</span><span class="p">,:,:])</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">mo_coeff</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">epol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">grid1d</span><span class="p">[:</span><span class="n">r2</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">mo_coeff</span><span class="p">[:</span><span class="n">r2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>
        <span class="n">epol</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)(</span><span class="n">grid1d</span><span class="p">[</span><span class="n">r2</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">epol</span></div>

<div class="viewcode-block" id="order_using_analytical_overlap"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.order_using_analytical_overlap">[docs]</a><span class="k">def</span> <span class="nf">order_using_analytical_overlap</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span><span class="n">itype</span><span class="o">=</span><span class="s1">&#39;molden&#39;</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">numproc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Performs an ordering routine using analytical overlap integrals between </span>
<span class="sd">  molecular orbitals. Set fid_list to None to omit the reading of input files.</span>
<span class="sd">  </span>
<span class="sd">  If :literal:`deg` is set to a value larger than zero, the molecular orbital </span>
<span class="sd">  coefficients are extrapolated with a polynomial of degree :literal:`deg`,</span>
<span class="sd">  before computing the molecular orbital overlap matrix.</span>
<span class="sd">  </span>
<span class="sd">  **Paramerters:**</span>
<span class="sd">  </span>
<span class="sd">  fid_list : list of str or None</span>
<span class="sd">    If not None, it contains the list of input file names.</span>
<span class="sd">  itype : str, choices={&#39;molden&#39;, &#39;gamess&#39;, &#39;gaussian.log&#39;, &#39;gaussian.fchk&#39;}</span>
<span class="sd">    Specifies the type of the input files.</span>
<span class="sd">  deg : int, optional</span>
<span class="sd">    If greater than zero, specifies the degree of the extrapolation polynomial</span>
<span class="sd">    for the molecular orbital coefficients.  </span>
<span class="sd">  </span>
<span class="sd">  **Returns:**</span>
<span class="sd">  </span>
<span class="sd">  index_list : numpy.ndarray, shape=(Nfiles,NMO)</span>
<span class="sd">    Contains the new indices of the molecular orbitals. If index &lt; 0, the </span>
<span class="sd">    molecular orbital changes its sign.</span>
<span class="sd">  mo_overlap : numpy.ndarray, shape=((Nfiles - 1),NMO,NMO)</span>
<span class="sd">    Contains the overlap matrix between the molecular orbitals of two neighboring</span>
<span class="sd">    geometries, i.e., mo_overlap[i,j,k] corresponds to overlap between the </span>
<span class="sd">    jth molecular orbital at geometry i to the kth molecular orbital at </span>
<span class="sd">    geometry (i+1).</span>
<span class="sd">  </span>
<span class="sd">  **Global Variables:**</span>
<span class="sd">  </span>
<span class="sd">  geo_spec_all, geo_info, ao_spec, ao_spherical, mo_coeff_all, mo_energy_all, mo_occ_all, sym, index_list</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">global</span> <span class="n">geo_spec_all</span><span class="p">,</span> <span class="n">geo_info</span><span class="p">,</span> <span class="n">ao_spec</span><span class="p">,</span> <span class="n">ao_spherical</span><span class="p">,</span> <span class="n">mo_coeff_all</span><span class="p">,</span> <span class="n">mo_energy_all</span><span class="p">,</span> <span class="n">mo_occ_all</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">index_list</span>
  
  <span class="k">if</span> <span class="n">fid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">read</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span><span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Starting the ordering routine using the molecular orbital overlap...&#39;</span><span class="p">)</span>

  <span class="n">iterate</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">)))</span>
  
  <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">The molecular orbital coefficients will be extrapolated&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">using a least squares polynomial fit of degree </span><span class="si">%d</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">deg</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">geo_spec_all</span><span class="p">])</span>
  
  <span class="n">mo_overlap</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
  <span class="n">index_list</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

  <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="n">index_list</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">index_list</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  
  <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">iterate</span><span class="p">:</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">rr</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">rr</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">deg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r1</span> <span class="o">&gt;=</span> <span class="n">deg</span><span class="p">):</span>
      <span class="n">ao_overlap</span> <span class="o">=</span> <span class="n">get_ao_overlap</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">r2</span><span class="p">],</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">r2</span><span class="p">],</span><span class="n">ao_spec</span><span class="p">,</span>
                                  <span class="n">ao_spherical</span><span class="o">=</span><span class="n">ao_spherical</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">ao_overlap</span> <span class="o">=</span> <span class="n">get_ao_overlap</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">r1</span><span class="p">],</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">r2</span><span class="p">],</span><span class="n">ao_spec</span><span class="p">,</span>
                                  <span class="n">ao_spherical</span><span class="o">=</span><span class="n">ao_spherical</span><span class="p">)</span>
    
    <span class="n">cs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
      <span class="n">mo_coeff</span> <span class="o">=</span> <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
      <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo_coeff</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">deg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r1</span> <span class="o">&gt;=</span> <span class="n">deg</span><span class="p">:</span>
        <span class="n">mo_r1</span> <span class="o">=</span> <span class="n">get_extrapolation</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">mo_coeff</span><span class="p">,</span><span class="n">grid1d</span><span class="o">=</span><span class="n">std</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">mo_r1</span> <span class="o">=</span> <span class="n">mo_coeff</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span>
      <span class="n">overlap</span> <span class="o">=</span> <span class="n">get_mo_overlap_matrix</span><span class="p">(</span><span class="n">mo_r1</span><span class="p">,</span><span class="n">mo_coeff</span><span class="p">[</span><span class="n">r2</span><span class="p">],</span><span class="n">ao_overlap</span><span class="p">,</span>
                                      <span class="n">numproc</span><span class="o">=</span><span class="n">numproc</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c1"># Iterate the rows of the overlap matrix</span>
        <span class="n">line_max</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1"># variable for maximum value in the current row</span>
        <span class="n">line_sort</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">overlap</span><span class="p">[</span><span class="n">i</span><span class="p">,:]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># sort the row</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">line_sort</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
          <span class="c1"># Is this value the maximum in the current column?</span>
          <span class="n">col_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">overlap</span><span class="p">[:,</span><span class="n">k</span><span class="p">]))</span> 
          <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">col_max</span><span class="p">:</span>
            <span class="n">line_max</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">line_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="c1"># Interchange the coefficients</span>
          <span class="n">mo_coeff</span><span class="p">[</span><span class="n">r2</span><span class="p">,[</span><span class="n">i</span><span class="p">,</span><span class="n">line_max</span><span class="p">],:]</span> <span class="o">=</span> <span class="n">mo_coeff</span><span class="p">[</span><span class="n">r2</span><span class="p">,[</span><span class="n">line_max</span><span class="p">,</span><span class="n">i</span><span class="p">],:]</span>
          <span class="n">overlap</span><span class="p">[:,[</span><span class="n">i</span><span class="p">,</span><span class="n">line_max</span><span class="p">]]</span> <span class="o">=</span> <span class="n">overlap</span><span class="p">[:,[</span><span class="n">line_max</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span>
          <span class="n">index_list</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,[</span><span class="n">i</span><span class="p">,</span><span class="n">line_max</span><span class="p">]]</span> <span class="o">=</span> <span class="n">index_list</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,[</span><span class="n">line_max</span><span class="p">,</span><span class="n">i</span><span class="p">]]</span>
      
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c1"># Change the signs</span>
        <span class="n">mo_coeff</span><span class="p">[</span><span class="n">r2</span><span class="p">,</span><span class="n">i</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">overlap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">overlap</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">overlap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">index_list</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">overlap</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
      
      <span class="n">mo_overlap</span><span class="p">[</span><span class="n">cs</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span>
      <span class="n">cs</span> <span class="o">+=</span> <span class="mi">1</span>
      
      <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo_coeff</span>
      
      <span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">s</span><span class="p">])[</span><span class="n">r2</span><span class="p">,:]</span>
      <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>
      <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">r2</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>
    
    <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1">#if not c % int(numpy.ceil(len(iterate)/10.)):</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Finished </span><span class="si">%d</span><span class="s1"> of </span><span class="si">%d</span><span class="s1"> geometries (</span><span class="si">%.1f</span><span class="s1"> s)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">iterate</span><span class="p">),</span> <span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
  
  <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mo_overlap</span><span class="p">:</span>
    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

  <span class="n">mo_overlap</span> <span class="o">=</span> <span class="n">tmp</span>
  
  <span class="k">return</span> <span class="n">index_list</span><span class="p">,</span> <span class="n">mo_overlap</span></div>

<div class="viewcode-block" id="order_using_extrapolation"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.order_using_extrapolation">[docs]</a><span class="k">def</span> <span class="nf">order_using_extrapolation</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span><span class="n">itype</span><span class="o">=</span><span class="s1">&#39;molden&#39;</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">use_mo_values</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">matrix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Performs an ordering routine using extrapolation of quantities related to </span>
<span class="sd">  the molecular orbitals. Set fid_list to None to omit the reading of input </span>
<span class="sd">  files.</span>
<span class="sd">  </span>
<span class="sd">  The molecular orbital coefficients (If use_mo_values is False) are </span>
<span class="sd">  extrapolated with a polynomial of degree :literal:`deg` and ordered by </span>
<span class="sd">  minimizing a selected norm (default: Euclidian norm).</span>
<span class="sd">  </span>
<span class="sd">  **Paramerters:**</span>
<span class="sd">  </span>
<span class="sd">  fid_list : list of str or None</span>
<span class="sd">    If not None, it contains the list of input file names.</span>
<span class="sd">  itype : str, choices={&#39;molden&#39;, &#39;gamess&#39;, &#39;gaussian.log&#39;, &#39;gaussian.fchk&#39;}</span>
<span class="sd">    Specifies the type of the input files.</span>
<span class="sd">  deg : int</span>
<span class="sd">    Specifies the degree of the extrapolation polynomial.</span>
<span class="sd">  use_mo_values : bool, optional</span>
<span class="sd">    If True, some molecular orbital values and their derivatives are computed</span>
<span class="sd">    at the nuclear positions. The ordering routine is applied for those values</span>
<span class="sd">    instead.</span>
<span class="sd">  matrix : None or numpy.ndarray with shape=(Nfiles,N,M)</span>
<span class="sd">    If not None, contains the data to be ordered.</span>
<span class="sd">  </span>
<span class="sd">  **Returns:**</span>
<span class="sd">  </span>
<span class="sd">  :if matrix is None:</span>
<span class="sd">    - index_list</span>
<span class="sd">  :else:</span>
<span class="sd">    - matrix, index_list</span>
<span class="sd">    </span>
<span class="sd">  index_list : numpy.ndarray, shape=(Nfiles,NMO)</span>
<span class="sd">    Contains the new indices of the molecular orbitals. If index &lt; 0, the </span>
<span class="sd">    molecular orbital changes its sign.</span>
<span class="sd">  matrix : numpy.ndarray, shape=(Nfiles,N,M)</span>
<span class="sd">    Contains the ordered matrix.</span>
<span class="sd">  </span>
<span class="sd">  **Global Variables:**</span>
<span class="sd">  </span>
<span class="sd">  geo_spec_all, geo_info, ao_spec, ao_spherical, mo_coeff_all, mo_energy_all, mo_occ_all, sym, index_list</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">global</span> <span class="n">geo_spec_all</span><span class="p">,</span> <span class="n">geo_info</span><span class="p">,</span> <span class="n">ao_spec</span><span class="p">,</span> <span class="n">ao_spherical</span><span class="p">,</span> <span class="n">mo_coeff_all</span><span class="p">,</span> <span class="n">mo_energy_all</span><span class="p">,</span> <span class="n">mo_occ_all</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">index_list</span>
  
  <span class="c1"># Read all input files</span>
  <span class="k">if</span> <span class="n">fid_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">read</span><span class="p">(</span><span class="n">fid_list</span><span class="p">,</span><span class="n">itype</span><span class="o">=</span><span class="n">itype</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

  <span class="n">radius</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">))</span> <span class="c1">#: We assume an equally spaced grid</span>
  
  <span class="k">if</span> <span class="n">deg</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">order_mo</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">order_mo_higher_deg</span>
  
  <span class="k">if</span> <span class="n">matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Odering backward&#39;</span><span class="p">)</span>
    <span class="n">matrix</span><span class="p">,</span> <span class="n">index_list</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">index_list</span><span class="o">=</span><span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">],</span><span class="n">backward</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Odering forward&#39;</span><span class="p">)</span>
    <span class="n">matrix</span><span class="p">,</span> <span class="n">index_list</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">index_list</span><span class="o">=</span><span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">],</span><span class="n">backward</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">index_list</span>
  
  <span class="n">index_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
  
  <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">ii_s</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Starting ordering of MOs of symmetry </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
    
    <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">])</span>
    
    <span class="n">mu</span> <span class="o">=</span> <span class="mf">5e-2</span>
    
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">use_mo_values</span><span class="p">:</span>
      <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Computing molecular orbitals at the nuclear positions&#39;</span><span class="p">)</span>
      <span class="n">matrix</span> <span class="o">=</span> <span class="n">compute_mo_list</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">,</span><span class="n">ao_spec</span><span class="p">,</span><span class="n">matrix</span><span class="p">,</span>
                               <span class="n">ao_spherical</span><span class="o">=</span><span class="n">ao_spherical</span><span class="p">,</span>
                               <span class="n">iter_drv</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
    
    
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Odering backward&#39;</span><span class="p">)</span>
    <span class="n">matrix</span><span class="p">,</span> <span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">index_list</span><span class="o">=</span><span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">],</span><span class="n">backward</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Odering forward&#39;</span><span class="p">)</span>
    <span class="n">matrix</span><span class="p">,</span> <span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">index_list</span><span class="o">=</span><span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">],</span><span class="n">backward</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      <span class="n">index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">])[</span><span class="n">rr</span><span class="p">,:]</span>
      <span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>
      <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,</span><span class="n">index</span><span class="p">]</span>
      <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">sign</span><span class="p">[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,</span><span class="n">index</span><span class="p">,:]</span> <span class="c1"># numpy.array(matrix,copy=True)</span>
    
  <span class="k">return</span> <span class="n">index_list</span></div>

<div class="viewcode-block" id="order_manually"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.order_manually">[docs]</a><span class="k">def</span> <span class="nf">order_manually</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">i_0</span><span class="p">,</span><span class="n">i_1</span><span class="p">,</span><span class="n">r_range</span><span class="p">,</span><span class="n">using_sign</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Performs the ordering manually.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">using_sign</span> <span class="k">else</span> <span class="mi">1</span>
  
  <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r_range</span><span class="p">:</span>
    <span class="n">matrix</span><span class="p">[</span><span class="n">rr</span><span class="p">,[</span><span class="nb">abs</span><span class="p">(</span><span class="n">i_0</span><span class="p">),</span><span class="nb">abs</span><span class="p">(</span><span class="n">i_1</span><span class="p">)]]</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">i_1</span><span class="p">)</span><span class="o">*</span><span class="n">matrix</span><span class="p">[</span><span class="n">rr</span><span class="p">,[</span><span class="nb">abs</span><span class="p">(</span><span class="n">i_1</span><span class="p">),</span><span class="nb">abs</span><span class="p">(</span><span class="n">i_0</span><span class="p">)]]</span>
  
  <span class="k">return</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="order_mo"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.order_mo">[docs]</a><span class="k">def</span> <span class="nf">order_mo</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span><span class="n">index_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">backward</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">use_factor</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Orders a 3d-matrix (shape=(Nfiles,NMO,NAO)) by interchanging the axis=1, </span>
<span class="sd">  i.e., NMO, applying linear extrapolation.&#39;&#39;&#39;</span>
  
  <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">index_list</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">index_list</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="s1">&#39;criterion&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1-norm&#39;</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2-norm&#39;</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;infty-norm&#39;</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;perc&#39;</span><span class="p">:</span> 
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;creterion </span><span class="si">%s</span><span class="s1"> is not defined!&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># Take 2-norm by default</span>
    <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
  
  <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
  
  <span class="n">x</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># Extrapolate linearly to the next point    </span>
  
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">i_0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]:</span>       
      <span class="n">f</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">use_factor</span><span class="p">:</span>
        <span class="n">is_larger</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">,:])</span> <span class="o">&gt;</span> <span class="n">mu</span>
        <span class="n">f</span><span class="p">[</span><span class="n">is_larger</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">,</span><span class="n">is_larger</span><span class="p">])</span>
      
      <span class="k">for</span> <span class="n">ii_s</span><span class="p">,</span><span class="n">sign</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">sign</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">,:])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">epol</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">,:])</span>
        
        <span class="n">cp</span> <span class="o">=</span> <span class="p">((</span><span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">epol</span><span class="p">[:]))</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">epol</span><span class="p">[:]))</span>
        <span class="n">is_smaller</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">cp</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">cm</span> <span class="k">if</span> <span class="n">is_smaller</span> <span class="k">else</span> <span class="n">cp</span>
        <span class="k">if</span> <span class="n">ii_s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">diff</span> <span class="o">=</span> <span class="n">current</span>
          <span class="n">i_1</span> <span class="o">=</span> <span class="n">i_0</span>
          <span class="n">new_signs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sign</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">is_smaller</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">test</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="n">diff</span><span class="p">):</span>
          <span class="n">diff</span> <span class="o">=</span> <span class="n">current</span>
          <span class="n">i_1</span> <span class="o">=</span> <span class="n">i_0</span>
          <span class="n">new_signs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sign</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">is_smaller</span><span class="p">]</span>
        <span class="c1"># Check other molecular orbitals</span>
        <span class="k">for</span> <span class="n">ik_index</span><span class="p">,</span><span class="n">ik</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]):</span>
          <span class="n">cp</span> <span class="o">=</span> <span class="p">((</span><span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ik</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">epol</span><span class="p">[:]))</span>
          <span class="n">cm</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ik</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">epol</span><span class="p">[:]))</span>
          <span class="n">is_smaller</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">cp</span><span class="p">)</span>
          <span class="n">current</span> <span class="o">=</span> <span class="n">cm</span> <span class="k">if</span> <span class="n">is_smaller</span> <span class="k">else</span> <span class="n">cp</span>
          
          <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="n">diff</span><span class="p">):</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">current</span>
            <span class="n">i_1</span> <span class="o">=</span> <span class="n">ik</span>
            <span class="n">new_signs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sign</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">is_smaller</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">i_0</span> <span class="o">!=</span> <span class="n">i_1</span><span class="p">:</span>
        <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_0</span><span class="p">,</span><span class="n">i_1</span><span class="p">],:]</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_1</span><span class="p">,</span><span class="n">i_0</span><span class="p">],:]</span>
        <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_0</span><span class="p">,</span><span class="n">i_1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_1</span><span class="p">,</span><span class="n">i_0</span><span class="p">]]</span>
      <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  
  <span class="k">return</span> <span class="n">mo</span><span class="p">,</span> <span class="n">index_list</span></div>

<div class="viewcode-block" id="order_mo_higher_deg"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.order_mo_higher_deg">[docs]</a><span class="k">def</span> <span class="nf">order_mo_higher_deg</span><span class="p">(</span><span class="n">mo</span><span class="p">,</span><span class="n">index_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">backward</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Orders a 3d-matrix (shape=(Nfiles,NMO,NAO)) by interchanging the axis=1, </span>
<span class="sd">  i.e., NMO, applying an extrapolation a polynomial fit with a Vandermonde matrix</span>
<span class="sd">  as implemented in numpy.&#39;&#39;&#39;</span>
  
  <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
  
  <span class="c1"># Check if degree is correctly set</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deg</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">deg</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Wrong choice for degree of the fitting polynomial!&#39;</span><span class="p">)</span>
  
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">using a least squares polynomial fit of degree </span><span class="si">%d</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">deg</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">index_list</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">index_list</span> <span class="o">*=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="s1">&#39;criterion&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1-norm&#39;</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2-norm&#39;</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;infty-norm&#39;</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;perc&#39;</span><span class="p">:</span> 
      <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;creterion </span><span class="si">%s</span><span class="s1"> is not defined!&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;criterion&#39;</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># Take 2-norm by default</span>
    <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
  
  <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">deg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">deg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">[</span><span class="n">deg</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">deg</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">i_0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]:</span>
      <span class="n">epol</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
          <span class="n">xnew</span> <span class="o">=</span> <span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
          <span class="n">y</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">x</span><span class="p">,</span><span class="n">i_0</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
          <span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>
          <span class="n">epol</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)(</span><span class="n">xnew</span><span class="p">)</span>
      
      <span class="n">cp</span> <span class="o">=</span> <span class="p">((</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">epol</span><span class="p">[:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">cm</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">epol</span><span class="p">[:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">is_smaller</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">cp</span><span class="p">)</span>
      <span class="n">current</span> <span class="o">=</span> <span class="n">cm</span> <span class="k">if</span> <span class="n">is_smaller</span> <span class="k">else</span> <span class="n">cp</span>
      
      <span class="n">diff</span> <span class="o">=</span> <span class="n">current</span>
      <span class="n">i_1</span> <span class="o">=</span> <span class="n">i_0</span>
      <span class="n">new_signs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">is_smaller</span><span class="p">]</span>
      <span class="c1"># Check other molecular orbitals</span>
      <span class="k">for</span> <span class="n">ik_index</span><span class="p">,</span><span class="n">ik</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="p">((</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ik</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">epol</span><span class="p">[:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">ik</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">epol</span><span class="p">[:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">is_smaller</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">cp</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">cm</span> <span class="k">if</span> <span class="n">is_smaller</span> <span class="k">else</span> <span class="n">cp</span>
        
        <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="n">diff</span><span class="p">):</span>
          <span class="n">diff</span> <span class="o">=</span> <span class="n">current</span>
          <span class="n">i_1</span> <span class="o">=</span> <span class="n">ik</span>
          <span class="n">new_signs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">is_smaller</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">i_0</span> <span class="o">!=</span> <span class="n">i_1</span><span class="p">:</span>
        <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_0</span><span class="p">,</span><span class="n">i_1</span><span class="p">],:]</span> <span class="o">=</span> <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_1</span><span class="p">,</span><span class="n">i_0</span><span class="p">],:]</span>
        <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_0</span><span class="p">,</span><span class="n">i_1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],[</span><span class="n">i_1</span><span class="p">,</span><span class="n">i_0</span><span class="p">]]</span>
      <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">mo</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">,:]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">index_list</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">i_0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">new_signs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  
  <span class="k">return</span> <span class="n">mo</span><span class="p">,</span> <span class="n">index_list</span></div>

<div class="viewcode-block" id="order_pm"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.order_pm">[docs]</a><span class="k">def</span> <span class="nf">order_pm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">backward</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">use_factor</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Outdated function to order exclusively the sign of a data set.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">backward</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  
  <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))[</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]:</span>
      <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="p">])</span>
      <span class="n">epol</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="p">])</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">ii_d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">ii_d</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">ii_d</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span><span class="o">-</span><span class="n">epol</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
      <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
  <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]:</span>
      <span class="k">for</span> <span class="n">ii_s</span><span class="p">,</span><span class="n">sign</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">)]:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">use_factor</span><span class="p">:</span>
          <span class="n">f</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">,:])</span> <span class="o">&gt;</span> <span class="n">mu</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">,:])</span> <span class="o">&gt;</span> <span class="n">mu</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],:]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">,:])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="p">])</span>
        <span class="n">epol</span> <span class="o">=</span> <span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">rr</span><span class="p">])</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="p">,:])</span>
        <span class="c1"># Euclidean norm (2 norm)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">f</span><span class="p">[:]</span><span class="o">*</span><span class="n">sign</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],:]</span> <span class="o">-</span> <span class="n">epol</span><span class="p">[:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Current value</span>
        <span class="k">if</span> <span class="n">ii_s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">diff</span> <span class="o">=</span> <span class="n">current</span>
          <span class="n">new_sign</span> <span class="o">=</span> <span class="n">sign</span>
        <span class="k">elif</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">:</span>
          <span class="n">new_sign</span> <span class="o">=</span> <span class="n">sign</span>
      <span class="n">y</span><span class="p">[</span><span class="n">rr</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">st</span><span class="p">[</span><span class="mi">2</span><span class="p">],:]</span> <span class="o">*=</span> <span class="n">new_sign</span>
        
  <span class="k">else</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Function order_pm only works for vectors and 2D matrices&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="save_hdf5"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.save_hdf5">[docs]</a><span class="k">def</span> <span class="nf">save_hdf5</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geo_info&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;geo_spec_all&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;ao_spec&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;ao_spherical&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;mo_coeff_all&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;mo_energy_all&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;mo_occ_all&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;sym&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;index_list&#39;</span><span class="p">],</span><span class="n">hdf5mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Writes all global variables specified in :literal:`variables` and all</span>
<span class="sd">  additional :literal:`kwargs` to an HDF5 file. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="kn">from</span> <span class="nn">orbkit.output</span> <span class="kn">import</span> <span class="n">hdf5_open</span><span class="p">,</span><span class="n">hdf5_append</span>
  
  <span class="c1"># Save HDF5 File</span>
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Saving Hierarchical Data Format file (HDF5) to </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="n">fid</span><span class="p">)</span>
  <span class="n">data_stored</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">HDF5_file</span> <span class="ow">in</span> <span class="n">hdf5_open</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">hdf5mode</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>          
          <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;sym&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
          <span class="n">hdf5_append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">HDF5_file</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
          <span class="n">data_stored</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Variable `</span><span class="si">%s</span><span class="s1">` is not in globals() or in **kwargs&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">hdf5_append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">HDF5_file</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">j</span><span class="p">)</span>
      <span class="n">data_stored</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Content: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_stored</span><span class="p">))</span></div>

<div class="viewcode-block" id="read_hdf5"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.read_hdf5">[docs]</a><span class="k">def</span> <span class="nf">read_hdf5</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geo_info&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;geo_spec_all&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;ao_spec&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;ao_spherical&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;mo_coeff_all&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;mo_energy_all&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;mo_occ_all&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;sym&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;index_list&#39;</span><span class="p">]):</span>
  <span class="sd">&#39;&#39;&#39;Reads all variables specified in :literal:`variables` from an HDF5 file</span>
<span class="sd">  created with :literal:`write_hdf5` and appends this data to the globals() of </span>
<span class="sd">  this module. </span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="kn">from</span> <span class="nn">orbkit.output</span> <span class="kn">import</span> <span class="n">hdf5_open</span><span class="p">,</span><span class="n">hdf52dict</span>
  
  <span class="c1"># Read HDF5 File</span>
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Reading Hierarchical Data Format file (HDF5) File from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fid</span><span class="p">)</span>
  <span class="n">data_stored</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">HDF5_file</span> <span class="ow">in</span> <span class="n">hdf5_open</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdf52dict</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">HDF5_file</span><span class="p">)</span>
        <span class="n">data_stored</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;sym&#39;</span><span class="p">:</span>
          <span class="n">s</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
          <span class="nb">globals</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">globals</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
  
  <span class="k">if</span> <span class="ow">not</span> <span class="n">data_stored</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find any data in `</span><span class="si">%s</span><span class="s1">` for the selected `variables`.&#39;</span> 
                  <span class="o">%</span> <span class="n">fid</span><span class="p">)</span>
  
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Found: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_stored</span><span class="p">))</span></div>

<div class="viewcode-block" id="construct_qc"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.construct_qc">[docs]</a><span class="k">def</span> <span class="nf">construct_qc</span><span class="p">():</span>
  <span class="sd">&#39;&#39;&#39;Converts all global variables to a list of `QCinfo` classes.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">orbkit.qcinfo</span> <span class="kn">import</span> <span class="n">QCinfo</span>
  <span class="n">QC</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">)):</span>
    <span class="n">QC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCinfo</span><span class="p">())</span>
    <span class="n">QC</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">geo_spec</span> <span class="o">=</span> <span class="n">geo_spec_all</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span>
    <span class="n">QC</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">geo_info</span> <span class="o">=</span> <span class="n">geo_info</span>
    <span class="n">QC</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">ao_spec</span> <span class="o">=</span> <span class="n">ao_spec</span>
    <span class="n">QC</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">ao_spherical</span> <span class="o">=</span> <span class="n">ao_spherical</span>
    <span class="n">QC</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">mo_spec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">ii_s</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">coeffs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">]):</span>
        <span class="n">QC</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">.</span><span class="n">mo_spec</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;coeffs&#39;</span><span class="p">:</span> <span class="n">coeffs</span><span class="p">,</span>
                               <span class="s1">&#39;energy&#39;</span> <span class="p">:</span> <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                               <span class="s1">&#39;occ_num&#39;</span> <span class="p">:</span> <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">ii_s</span><span class="p">][</span><span class="n">rr</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                               <span class="s1">&#39;sym&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">)})</span>
  
  <span class="k">return</span> <span class="n">QC</span></div>

<div class="viewcode-block" id="compute_mo_list"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.compute_mo_list">[docs]</a><span class="k">def</span> <span class="nf">compute_mo_list</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">,</span><span class="n">ao_spec</span><span class="p">,</span><span class="n">mo_matrix</span><span class="p">,</span><span class="n">ao_spherical</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">iter_drv</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">]):</span>
  <span class="sd">&#39;&#39;&#39;Computes the values of the molecular orbitals and, if requested, their </span>
<span class="sd">  derivatives at the nuclear positions for a complete </span>
<span class="sd">  mo_matrix (shape=(Nfiles,NMO,NAO)).&#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">orbkit.core</span> <span class="kn">import</span> <span class="n">ao_creator</span>
  
  <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo_matrix</span><span class="p">)</span>
  <span class="n">mo_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>

  <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">geo_spec</span> <span class="o">=</span> <span class="n">geo_spec_all</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">geo_spec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">geo_spec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">geo_spec</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">drv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iter_drv</span><span class="p">):</span>
      <span class="n">ao_list</span> <span class="o">=</span> <span class="n">ao_creator</span><span class="p">(</span><span class="n">geo_spec</span><span class="p">,</span><span class="n">ao_spec</span><span class="p">,</span><span class="n">ao_spherical</span><span class="o">=</span><span class="n">ao_spherical</span><span class="p">,</span>
                           <span class="n">exp_list</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">is_vector</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">drv</span><span class="o">=</span><span class="n">drv</span><span class="p">,</span>
                           <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i_mo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">i_ao</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
          <span class="n">mo_list</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_mo</span><span class="p">,</span><span class="n">N</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">mo_matrix</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">i_mo</span><span class="p">,</span><span class="n">i_ao</span><span class="p">]</span> <span class="o">*</span> <span class="n">ao_list</span><span class="p">[</span><span class="n">i_ao</span><span class="p">,:]</span>
    
    <span class="k">return</span> <span class="n">mo_list</span></div>

<div class="viewcode-block" id="data_interp"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.data_interp">[docs]</a><span class="k">def</span> <span class="nf">data_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xnew</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Interpolates a dataset y(x) to y(xnew) using B-Splines of order k.&#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
  <span class="n">tck</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
  <span class="n">ynew</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span><span class="n">tck</span><span class="p">,</span><span class="n">der</span><span class="o">=</span><span class="n">der</span><span class="p">)</span>
  
  <span class="k">return</span> <span class="n">ynew</span></div>

<span class="k">def</span> <span class="nf">splrep_all</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
  <span class="k">global</span> <span class="n">geo_spec_tck</span><span class="p">,</span> <span class="n">mo_coeff_tck</span><span class="p">,</span> <span class="n">mo_energy_tck</span><span class="p">,</span> <span class="n">mo_occ_tck</span>
  
  <span class="n">geo_spec_tck</span>  <span class="o">=</span> <span class="p">[]</span>
  <span class="n">mo_coeff_tck</span>  <span class="o">=</span> <span class="p">[]</span>
  <span class="n">mo_energy_tck</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">mo_occ_tck</span>    <span class="o">=</span> <span class="p">[]</span>
  
  <span class="n">shape</span> <span class="o">=</span> <span class="n">geo_spec_all</span><span class="o">.</span><span class="n">shape</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">geo_spec_tck</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
      <span class="n">geo_spec_tck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">geo_spec_all</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                              <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
  
  <span class="k">for</span> <span class="n">i_mo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mo_coeff_all</span><span class="p">)):</span>
    <span class="n">mo_coeff_tck</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="n">mo_energy_tck</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="n">mo_occ_tck</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="n">mo_coeff_tck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
      <span class="n">mo_energy_tck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mo_energy_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span>
                               <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
      <span class="n">mo_occ_tck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mo_occ_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">mo_coeff_tck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                                    <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">][:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                                    <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<div class="viewcode-block" id="interpolate_all"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.interpolate_all">[docs]</a><span class="k">def</span> <span class="nf">interpolate_all</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xnew</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Interpolates a dataset y(x) to y(xnew) using B-Splines of order k.&#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
  <span class="k">global</span> <span class="n">geo_spec_all</span><span class="p">,</span> <span class="n">mo_coeff_all</span><span class="p">,</span> <span class="n">mo_energy_all</span><span class="p">,</span> <span class="n">mo_occ_all</span> 
  
  <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
  <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
  <span class="n">tmp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>  
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
      <span class="n">tmp</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">geo_spec_all</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">xnew</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="n">geo_spec_all</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
  
  <span class="k">for</span> <span class="n">i_mo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mo_coeff_all</span><span class="p">)):</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>  
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">tmp</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">][:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">xnew</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mo_energy_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>  
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="n">tmp</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mo_energy_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span><span class="n">xnew</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mo_energy_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mo_occ_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>  
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="n">tmp</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mo_occ_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span><span class="n">xnew</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mo_occ_all</span><span class="p">[</span><span class="n">i_mo</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span></div>

<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.plot">[docs]</a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">mo_matrix</span><span class="p">,</span><span class="n">symmetry</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">,</span><span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span>
         <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;MO coefficients&#39;</span><span class="p">,</span><span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
         <span class="n">plt_dir</span><span class="o">=</span><span class="s1">&#39;Plots&#39;</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">x_grid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Plots all molecular orbital coefficients of one symmetry.&#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
  <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
  <span class="kn">import</span> <span class="nn">os</span>
  
  <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Plotting data of symmetry </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">symmetry</span><span class="p">,</span><span class="n">plt_dir</span><span class="p">))</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plt_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">plt_dir</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">mo_matrix</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mo_matrix</span> <span class="o">=</span> <span class="n">mo_matrix</span><span class="p">[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
  
  <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">mo_matrix</span><span class="p">)</span>
  
  <span class="c1">#colors = &#39;bgrcmyk&#39;</span>
  
  <span class="k">def</span> <span class="nf">plot_mo</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">curves</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ij</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
      <span class="n">Y</span> <span class="o">=</span> <span class="n">mo_matrix</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">ij</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">x_grid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="o">+</span><span class="n">x0</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">x_grid</span>
      <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">:</span>
        <span class="n">curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span> <span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">))</span> <span class="c1">#colors[ij%len(colors)]+</span>
    
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%d</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span>  <span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symmetry</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="c1">#ax.xaxis.set_minor_locator(MultipleLocator(1))</span>
    <span class="c1">#ax.xaxis.grid(grid, which=&#39;minor&#39;)</span>
    <span class="c1">#ax.grid(grid, which=&#39;both&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
  
  <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="kn">import</span> <span class="n">PdfPages</span>
    <span class="n">output_fid</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">.pdf&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">symmetry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">output_fid</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plt_dir</span><span class="p">,</span><span class="n">output_fid</span><span class="p">))</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_mo</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_mo</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="n">output_fid</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symmetry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
      <span class="n">display</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">output_fid</span><span class="p">)</span>
      <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plt_dir</span><span class="p">,</span> <span class="n">output_fid</span><span class="p">),</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;output_format `</span><span class="si">%s</span><span class="s1">` is not supported&#39;</span> <span class="o">%</span> <span class="n">output_format</span><span class="p">)</span></div>

<div class="viewcode-block" id="show_selected_mos"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.show_selected_mos">[docs]</a><span class="k">def</span> <span class="nf">show_selected_mos</span><span class="p">(</span><span class="n">selected_mos</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">select_slice</span><span class="o">=</span><span class="s1">&#39;xz&#39;</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                      <span class="n">npts</span><span class="o">=</span><span class="p">[</span><span class="mi">26</span><span class="p">,</span><span class="mi">51</span><span class="p">],</span><span class="n">minpts</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">],</span><span class="n">maxpts</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="n">nuclear_pos</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Uses orbkit to compute selected molecular orbitals and plots it with</span>
<span class="sd">  :func:`contour_mult_mo`.&#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">orbkit</span> <span class="kn">import</span> <span class="n">grid</span>
  <span class="kn">from</span> <span class="nn">orbkit.core</span> <span class="kn">import</span> <span class="n">ao_creator</span><span class="p">,</span><span class="n">mo_creator</span>
  <span class="n">r</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span><span class="n">r0</span><span class="o">+</span><span class="n">steps</span><span class="p">)</span>
  
  <span class="n">grid</span><span class="o">.</span><span class="n">N_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">grid</span><span class="o">.</span><span class="n">min_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">grid</span><span class="o">.</span><span class="n">max_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">select_slice</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">min_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">where</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">max_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">where</span>
  <span class="k">elif</span> <span class="n">select_slice</span> <span class="o">==</span> <span class="s1">&#39;yz&#39;</span><span class="p">:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">min_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">where</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">max_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">where</span>
  <span class="k">elif</span> <span class="n">select_slice</span> <span class="o">==</span> <span class="s1">&#39;xz&#39;</span><span class="p">:</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">min_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">where</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">max_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">where</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`show_selected_mos` currently only&#39;</span> <span class="o">+</span> 
                     <span class="s1">&#39;supports slices parallel to the following planes:&#39;</span> <span class="o">+</span>
                     <span class="s1">&#39;select_slice = `xy`, `yz`, or `xz`&#39;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">N_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">npts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">min_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">minpts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">max_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxpts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  
  <span class="c1"># Initialize grid</span>
  <span class="n">grid</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">grid</span><span class="o">.</span><span class="n">grid_init</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">xyz</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">grid</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">grid</span><span class="o">.</span><span class="n">z</span>
  <span class="k">for</span> <span class="n">mo_sel</span> <span class="ow">in</span> <span class="n">selected_mos</span><span class="p">:</span>
    <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">mo_sel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">mo</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
      <span class="n">ao_list</span> <span class="o">=</span> <span class="n">ao_creator</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">ao_spec</span><span class="p">,</span><span class="n">ao_spherical</span><span class="o">=</span><span class="n">ao_spherical</span><span class="p">)</span>
      <span class="n">mo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mo_creator</span><span class="p">(</span><span class="n">ao_list</span><span class="p">,</span><span class="n">mo_coeff_all</span><span class="p">[</span><span class="n">sym</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">rr</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">npts</span><span class="p">)))</span>
    
    <span class="n">f</span><span class="p">,</span> <span class="n">pics</span> <span class="o">=</span> <span class="n">contour_mult_mo</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">xyz</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">mo</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">select_slice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylabel</span><span class="o">=</span><span class="n">select_slice</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;MO:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mo_sel</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="n">r0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pics</span><span class="p">):</span>
      <span class="n">pic</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">rr</span><span class="p">,:,</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">geo_spec_all</span><span class="p">[</span><span class="n">rr</span><span class="p">,:,</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nuclear_pos</span><span class="p">,</span>
               <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="contour_mult_mo"><a class="viewcode-back" href="../../refs/funcref.html#orbkit.multiple_files.contour_mult_mo">[docs]</a><span class="k">def</span> <span class="nf">contour_mult_mo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">mo</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Uses matplotlib to show slices of a molecular orbitals.&#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
  
  <span class="c1"># Plot slices</span>
  <span class="n">f</span><span class="p">,</span> <span class="n">pics</span> <span class="o">=</span> \
              <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mo</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mo</span><span class="p">)))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="n">vmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mo</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pics</span><span class="p">):</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">50</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>\
        <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">50</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">pic</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>  
    <span class="n">pic</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>  
    <span class="n">pic</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Data Point </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r0</span><span class="o">+</span><span class="n">i</span><span class="p">))</span>
  
  <span class="n">f</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
  <span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">f</span><span class="p">,</span><span class="n">pics</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Gunter Hermann, Vincent Pohl, Lukas Eugen Marsoner Steinkasserer, Axel Schild, and Jean Christophe Tremblay.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Documentation</span>
      v: 1.0 (stable)
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://orbkit.github.io/dev">1.1 (development)</a></dd>
        
          <dd><a href="https://orbkit.github.io/">1.0 (stable)</a></dd>
        
      </dl>
    </div>
  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>