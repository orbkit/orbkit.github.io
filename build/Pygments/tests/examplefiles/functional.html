

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Functional Programming HOWTO &mdash; orbkit 0.2.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/orbkit.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="orbkit 0.2.2 documentation" href="../../../../index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> orbkit
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../general.html">General Aspects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quick.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gridbased/index.html">Grid-Based Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nongridbased/index.html">Non Grid-Based Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../adtutorials/index.html">Advanced Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../refs/index.html">Orbkit References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../licence.html">Licence Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../impressum.html">Impressum - Legal Notice</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">orbkit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
    <li>Functional Programming HOWTO</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/build/Pygments/tests/examplefiles/functional.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="functional-programming-howto">
<h1><a class="toc-backref" href="#id1">Functional Programming HOWTO</a><a class="headerlink" href="#functional-programming-howto" title="Permalink to this headline">¶</a></h1>
<p><strong>Version 0.30</strong></p>
<p>(This is a first draft.  Please send comments/error
reports/suggestions to <a class="reference external" href="mailto:amk&#37;&#52;&#48;amk&#46;ca">amk<span>&#64;</span>amk<span>&#46;</span>ca</a>.  This URL is probably not going to
be the final location of the document, so be careful about linking to
it &#8211; you may want to add a disclaimer.)</p>
<p>In this document, we&#8217;ll take a tour of Python&#8217;s features suitable for
implementing programs in a functional style.  After an introduction to
the concepts of functional programming, we&#8217;ll look at language
features such as iterators and generators and relevant library modules
such as <code class="docutils literal"><span class="pre">itertools</span></code> and <code class="docutils literal"><span class="pre">functools</span></code>.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#functional-programming-howto" id="id1">Functional Programming HOWTO</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a><ul>
<li><a class="reference internal" href="#formal-provability" id="id3">Formal provability</a></li>
<li><a class="reference internal" href="#modularity" id="id4">Modularity</a></li>
<li><a class="reference internal" href="#ease-of-debugging-and-testing" id="id5">Ease of debugging and testing</a></li>
<li><a class="reference internal" href="#composability" id="id6">Composability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iterators" id="id7">Iterators</a><ul>
<li><a class="reference internal" href="#data-types-that-support-iterators" id="id8">Data Types That Support Iterators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generator-expressions-and-list-comprehensions" id="id9">Generator expressions and list comprehensions</a></li>
<li><a class="reference internal" href="#generators" id="id10">Generators</a><ul>
<li><a class="reference internal" href="#passing-values-into-a-generator" id="id11">Passing values into a generator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#built-in-functions" id="id12">Built-in functions</a></li>
<li><a class="reference internal" href="#small-functions-and-the-lambda-statement" id="id13">Small functions and the lambda statement</a></li>
<li><a class="reference internal" href="#the-itertools-module" id="id14">The itertools module</a><ul>
<li><a class="reference internal" href="#creating-new-iterators" id="id15">Creating new iterators</a></li>
<li><a class="reference internal" href="#calling-functions-on-elements" id="id16">Calling functions on elements</a></li>
<li><a class="reference internal" href="#selecting-elements" id="id17">Selecting elements</a></li>
<li><a class="reference internal" href="#grouping-elements" id="id18">Grouping elements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-functools-module" id="id19">The functools module</a></li>
<li><a class="reference internal" href="#the-operator-module" id="id20">The operator module</a></li>
<li><a class="reference internal" href="#the-functional-module" id="id21">The functional module</a></li>
<li><a class="reference internal" href="#revision-history-and-acknowledgements" id="id22">Revision History and Acknowledgements</a></li>
<li><a class="reference internal" href="#references" id="id23">References</a><ul>
<li><a class="reference internal" href="#general" id="id24">General</a></li>
<li><a class="reference internal" href="#python-specific" id="id25">Python-specific</a></li>
<li><a class="reference internal" href="#python-documentation" id="id26">Python documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This section explains the basic concept of functional programming; if
you&#8217;re just interested in learning about Python language features,
skip to the next section.</p>
<p>Programming languages support decomposing problems in several different
ways:</p>
<ul class="simple">
<li>Most programming languages are <strong>procedural</strong>:
programs are lists of instructions that tell the computer what to
do with the program&#8217;s input.
C, Pascal, and even Unix shells are procedural languages.</li>
<li>In <strong>declarative</strong> languages, you write a specification that describes
the problem to be solved, and the language implementation figures out
how to perform the computation efficiently.  SQL is the declarative
language you&#8217;re most likely to be familiar with; a SQL query describes
the data set you want to retrieve, and the SQL engine decides whether to
scan tables or use indexes, which subclauses should be performed first,
etc.</li>
<li><strong>Object-oriented</strong> programs manipulate  collections of objects.
Objects have internal state and support methods that query or modify
this internal state in some way. Smalltalk and Java are
object-oriented languages.  C++ and Python are languages that
support object-oriented programming, but don&#8217;t force the use
of object-oriented features.</li>
<li><strong>Functional</strong> programming decomposes a problem into a set of functions.
Ideally, functions only take inputs and produce outputs, and don&#8217;t have any
internal state that affects the output produced for a given input.
Well-known functional languages include the ML family (Standard ML,
OCaml, and other variants) and Haskell.</li>
</ul>
<p>The designers of some computer languages have chosen one approach to
programming that&#8217;s emphasized.  This often makes it difficult to
write programs that use a different approach.  Other languages are
multi-paradigm languages that support several different approaches.  Lisp,
C++, and Python are multi-paradigm; you can write programs or
libraries that are largely procedural, object-oriented, or functional
in all of these languages.  In a large program, different sections
might be written using different approaches; the GUI might be object-oriented
while the processing logic is procedural or functional, for example.</p>
<p>In a functional program, input flows through a set of functions. Each
function operates on its input and produces some output.  Functional
style frowns upon functions with side effects that modify internal
state or make other changes that aren&#8217;t visible in the function&#8217;s
return value.  Functions that have no side effects at all are
called <strong>purely functional</strong>.
Avoiding side effects means not using data structures
that get updated as a program runs; every function&#8217;s output
must only depend on its input.</p>
<p>Some languages are very strict about purity and don&#8217;t even have
assignment statements such as <code class="docutils literal"><span class="pre">a=3</span></code> or <code class="docutils literal"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code>, but it&#8217;s
difficult to avoid all side effects.  Printing to the screen or
writing to a disk file are side effects, for example.  For example, in
Python a <code class="docutils literal"><span class="pre">print</span></code> statement or a <code class="docutils literal"><span class="pre">time.sleep(1)</span></code> both return no
useful value; they&#8217;re only called for their side effects of sending
some text to the screen or pausing execution for a second.</p>
<p>Python programs written in functional style usually won&#8217;t go to the
extreme of avoiding all I/O or all assignments; instead, they&#8217;ll
provide a functional-appearing interface but will use non-functional
features internally.  For example, the implementation of a function
will still use assignments to local variables, but won&#8217;t modify global
variables or have other side effects.</p>
<p>Functional programming can be considered the opposite of
object-oriented programming.  Objects are little capsules containing
some internal state along with a collection of method calls that let
you modify this state, and programs consist of making the right set of
state changes.  Functional programming wants to avoid state changes as
much as possible and works with data flowing between functions.  In
Python you might combine the two approaches by writing functions that
take and return instances representing objects in your application
(e-mail messages, transactions, etc.).</p>
<p>Functional design may seem like an odd constraint to work under.  Why
should you avoid objects and side effects?  There are theoretical and
practical advantages to the functional style:</p>
<ul class="simple">
<li>Formal provability.</li>
<li>Modularity.</li>
<li>Composability.</li>
<li>Ease of debugging and testing.</li>
</ul>
<div class="section" id="formal-provability">
<h3><a class="toc-backref" href="#id3">Formal provability</a><a class="headerlink" href="#formal-provability" title="Permalink to this headline">¶</a></h3>
<p>A theoretical benefit is that it&#8217;s easier to construct a mathematical proof
that a functional program is correct.</p>
<p>For a long time researchers have been interested in finding ways to
mathematically prove programs correct.  This is different from testing
a program on numerous inputs and concluding that its output is usually
correct, or reading a program&#8217;s source code and concluding that the
code looks right; the goal is instead a rigorous proof that a program
produces the right result for all possible inputs.</p>
<p>The technique used to prove programs correct is to write down
<strong>invariants</strong>, properties of the input data and of the program&#8217;s
variables that are always true.  For each line of code, you then show
that if invariants X and Y are true <strong>before</strong> the line is executed,
the slightly different invariants X&#8217; and Y&#8217; are true <strong>after</strong>
the line is executed.  This continues until you reach the end of the
program, at which point the invariants should match the desired
conditions on the program&#8217;s output.</p>
<p>Functional programming&#8217;s avoidance of assignments arose because
assignments are difficult to handle with this technique;
assignments can break invariants that were true before the assignment
without producing any new invariants that can be propagated onward.</p>
<p>Unfortunately, proving programs correct is largely impractical and not
relevant to Python software. Even trivial programs require proofs that
are several pages long; the proof of correctness for a moderately
complicated program would be enormous, and few or none of the programs
you use daily (the Python interpreter, your XML parser, your web
browser) could be proven correct.  Even if you wrote down or generated
a proof, there would then be the question of verifying the proof;
maybe there&#8217;s an error in it, and you wrongly believe you&#8217;ve proved
the program correct.</p>
</div>
<div class="section" id="modularity">
<h3><a class="toc-backref" href="#id4">Modularity</a><a class="headerlink" href="#modularity" title="Permalink to this headline">¶</a></h3>
<p>A more practical benefit of functional programming is that it forces
you to break apart your problem into small pieces.  Programs are more
modular as a result.  It&#8217;s easier to specify and write a small
function that does one thing than a large function that performs a
complicated transformation.  Small functions are also easier to read
and to check for errors.</p>
</div>
<div class="section" id="ease-of-debugging-and-testing">
<h3><a class="toc-backref" href="#id5">Ease of debugging and testing</a><a class="headerlink" href="#ease-of-debugging-and-testing" title="Permalink to this headline">¶</a></h3>
<p>Testing and debugging a functional-style program is easier.</p>
<p>Debugging is simplified because functions are generally small and
clearly specified.  When a program doesn&#8217;t work, each function is an
interface point where you can check that the data are correct.  You
can look at the intermediate inputs and outputs to quickly isolate the
function that&#8217;s responsible for a bug.</p>
<p>Testing is easier because each function is a potential subject for a
unit test.  Functions don&#8217;t depend on system state that needs to be
replicated before running a test; instead you only have to synthesize
the right input and then check that the output matches expectations.</p>
</div>
<div class="section" id="composability">
<h3><a class="toc-backref" href="#id6">Composability</a><a class="headerlink" href="#composability" title="Permalink to this headline">¶</a></h3>
<p>As you work on a functional-style program, you&#8217;ll write a number of
functions with varying inputs and outputs.  Some of these functions
will be unavoidably specialized to a particular application, but
others will be useful in a wide variety of programs.  For example, a
function that takes a directory path and returns all the XML files in
the directory, or a function that takes a filename and returns its
contents, can be applied to many different situations.</p>
<p>Over time you&#8217;ll form a personal library of utilities.  Often you&#8217;ll
assemble new programs by arranging existing functions in a new
configuration and writing a few functions specialized for the current
task.</p>
</div>
</div>
<div class="section" id="iterators">
<h2><a class="toc-backref" href="#id7">Iterators</a><a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h2>
<p>I&#8217;ll start by looking at a Python language feature that&#8217;s an important
foundation for writing functional-style programs: iterators.</p>
<p>An iterator is an object representing a stream of data; this object
returns the data one element at a time.  A Python iterator must
support a method called <code class="docutils literal"><span class="pre">next()</span></code> that takes no arguments and always
returns the next element of the stream.  If there are no more elements
in the stream, <code class="docutils literal"><span class="pre">next()</span></code> must raise the <code class="docutils literal"><span class="pre">StopIteration</span></code> exception.
Iterators don&#8217;t have to be finite, though; it&#8217;s perfectly reasonable
to write an iterator that produces an infinite stream of data.</p>
<p>The built-in <code class="docutils literal"><span class="pre">iter()</span></code> function takes an arbitrary object and tries
to return an iterator that will return the object&#8217;s contents or
elements, raising <code class="docutils literal"><span class="pre">TypeError</span></code> if the object doesn&#8217;t support
iteration.  Several of Python&#8217;s built-in data types support iteration,
the most common being lists and dictionaries.  An object is called
an <strong>iterable</strong> object if you can get an iterator for it.</p>
<p>You can experiment with the iteration interface manually:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">it</span>
<span class="go">&lt;iterator object at 0x8116870&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">?</span>
<span class="gr">StopIteration</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Python expects iterable objects in several different contexts, the
most important being the <code class="docutils literal"><span class="pre">for</span></code> statement.  In the statement <code class="docutils literal"><span class="pre">for</span> <span class="pre">X</span> <span class="pre">in</span> <span class="pre">Y</span></code>,
Y must be an iterator or some object for which <code class="docutils literal"><span class="pre">iter()</span></code> can create
an iterator.  These two statements are equivalent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">i</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">i</span>
</pre></div>
</div>
<p>Iterators can be materialized as lists or tuples by using the
<code class="docutils literal"><span class="pre">list()</span></code> or <code class="docutils literal"><span class="pre">tuple()</span></code> constructor functions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">(1, 2, 3)</span>
</pre></div>
</div>
<p>Sequence unpacking also supports iterators: if you know an iterator
will return N elements, you can unpack them into an N-tuple:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">iterator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
<span class="go">(1, 2, 3)</span>
</pre></div>
</div>
<p>Built-in functions such as <code class="docutils literal"><span class="pre">max()</span></code> and <code class="docutils literal"><span class="pre">min()</span></code> can take a single
iterator argument and will return the largest or smallest element.
The <code class="docutils literal"><span class="pre">&quot;in&quot;</span></code> and <code class="docutils literal"><span class="pre">&quot;not</span> <span class="pre">in&quot;</span></code> operators also support iterators: <code class="docutils literal"><span class="pre">X</span> <span class="pre">in</span>
<span class="pre">iterator</span></code> is true if X is found in the stream returned by the
iterator.  You&#8217;ll run into obvious problems if the iterator is
infinite; <code class="docutils literal"><span class="pre">max()</span></code>, <code class="docutils literal"><span class="pre">min()</span></code>, and <code class="docutils literal"><span class="pre">&quot;not</span> <span class="pre">in&quot;</span></code> will never return, and
if the element X never appears in the stream, the <code class="docutils literal"><span class="pre">&quot;in&quot;</span></code> operator
won&#8217;t return either.</p>
<p>Note that you can only go forward in an iterator; there&#8217;s no way to
get the previous element, reset the iterator, or make a copy of it.
Iterator objects can optionally provide these additional capabilities,
but the iterator protocol only specifies the <code class="docutils literal"><span class="pre">next()</span></code> method.
Functions may therefore consume all of the iterator&#8217;s output, and if
you need to do something different with the same stream, you&#8217;ll have
to create a new iterator.</p>
<div class="section" id="data-types-that-support-iterators">
<h3><a class="toc-backref" href="#id8">Data Types That Support Iterators</a><a class="headerlink" href="#data-types-that-support-iterators" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;ve already seen how lists and tuples support iterators.  In fact,
any Python sequence type, such as strings, will automatically support
creation of an iterator.</p>
<p>Calling <code class="docutils literal"><span class="pre">iter()</span></code> on a dictionary returns an iterator that will loop
over the dictionary&#8217;s keys:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Jan&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="gp">... </span>     <span class="s1">&#39;Jul&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="n">key</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="go">Mar 3</span>
<span class="go">Feb 2</span>
<span class="go">Aug 8</span>
<span class="go">Sep 9</span>
<span class="go">May 5</span>
<span class="go">Jun 6</span>
<span class="go">Jul 7</span>
<span class="go">Jan 1</span>
<span class="go">Apr 4</span>
<span class="go">Nov 11</span>
<span class="go">Dec 12</span>
<span class="go">Oct 10</span>
</pre></div>
</div>
<p>Note that the order is essentially random, because it&#8217;s based on the
hash ordering of the objects in the dictionary.</p>
<p>Applying <code class="docutils literal"><span class="pre">iter()</span></code> to a dictionary always loops over the keys, but
dictionaries have methods that return other iterators.  If you want to
iterate over keys, values, or key/value pairs, you can explicitly call
the <code class="docutils literal"><span class="pre">iterkeys()</span></code>, <code class="docutils literal"><span class="pre">itervalues()</span></code>, or <code class="docutils literal"><span class="pre">iteritems()</span></code> methods to
get an appropriate iterator.</p>
<p>The <code class="docutils literal"><span class="pre">dict()</span></code> constructor can accept an iterator that returns a
finite stream of <code class="docutils literal"><span class="pre">(key,</span> <span class="pre">value)</span></code> tuples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Italy&#39;</span><span class="p">,</span> <span class="s1">&#39;Rome&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="s1">&#39;Paris&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;Washington DC&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
<span class="go">{&#39;Italy&#39;: &#39;Rome&#39;, &#39;US&#39;: &#39;Washington DC&#39;, &#39;France&#39;: &#39;Paris&#39;}</span>
</pre></div>
</div>
<p>Files also support iteration by calling the <code class="docutils literal"><span class="pre">readline()</span></code>
method until there are no more lines in the file.  This means you can
read each line of a file like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
    <span class="c1"># do something for each line</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Sets can take their contents from an iterable and let you iterate over
the set&#8217;s elements:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">i</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="generator-expressions-and-list-comprehensions">
<h2><a class="toc-backref" href="#id9">Generator expressions and list comprehensions</a><a class="headerlink" href="#generator-expressions-and-list-comprehensions" title="Permalink to this headline">¶</a></h2>
<p>Two common operations on an iterator&#8217;s output are 1) performing some
operation for every element, 2) selecting a subset of elements that
meet some condition.  For example, given a list of strings, you might
want to strip off trailing whitespace from each line or extract all
the strings containing a given substring.</p>
<p>List comprehensions and generator expressions (short form: &#8220;listcomps&#8221;
and &#8220;genexps&#8221;) are a concise notation for such operations, borrowed
from the functional programming language Haskell
(<a class="reference external" href="http://www.haskell.org">http://www.haskell.org</a>).  You can strip all the whitespace from a
stream of strings with the following code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">line_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;  line 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;line 2  </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

<span class="c1"># Generator expression -- returns iterator</span>
<span class="n">stripped_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">)</span>

<span class="c1"># List comprehension -- returns list</span>
<span class="n">stripped_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span><span class="p">]</span>
</pre></div>
</div>
<p>You can select only certain elements by adding an <code class="docutils literal"><span class="pre">&quot;if&quot;</span></code> condition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">stripped_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_list</span>
                 <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>With a list comprehension, you get back a Python list;
<code class="docutils literal"><span class="pre">stripped_list</span></code> is a list containing the resulting lines, not an
iterator.  Generator expressions return an iterator that computes the
values as necessary, not needing to materialize all the values at
once.  This means that list comprehensions aren&#8217;t useful if you&#8217;re
working with iterators that return an infinite stream or a very large
amount of data.  Generator expressions are preferable in these
situations.</p>
<p>Generator expressions are surrounded by parentheses (&#8220;()&#8221;) and list
comprehensions are surrounded by square brackets (&#8220;[]&#8221;).  Generator
expressions have the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span> <span class="n">expression</span> <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">sequence1</span>
             <span class="k">if</span> <span class="n">condition1</span>
             <span class="k">for</span> <span class="n">expr2</span> <span class="ow">in</span> <span class="n">sequence2</span>
             <span class="k">if</span> <span class="n">condition2</span>
             <span class="k">for</span> <span class="n">expr3</span> <span class="ow">in</span> <span class="n">sequence3</span> <span class="o">...</span>
             <span class="k">if</span> <span class="n">condition3</span>
             <span class="k">for</span> <span class="n">exprN</span> <span class="ow">in</span> <span class="n">sequenceN</span>
             <span class="k">if</span> <span class="n">conditionN</span> <span class="p">)</span>
</pre></div>
</div>
<p>Again, for a list comprehension only the outside brackets are
different (square brackets instead of parentheses).</p>
<p>The elements of the generated output will be the successive values of
<code class="docutils literal"><span class="pre">expression</span></code>.  The <code class="docutils literal"><span class="pre">if</span></code> clauses are all optional; if present,
<code class="docutils literal"><span class="pre">expression</span></code> is only evaluated and added to the result when
<code class="docutils literal"><span class="pre">condition</span></code> is true.</p>
<p>Generator expressions always have to be written inside parentheses,
but the parentheses signalling a function call also count.  If you
want to create an iterator that will be immediately passed to a
function you can write:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">obj_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">count</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">list_all_objects</span><span class="p">())</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">for...in</span></code> clauses contain the sequences to be iterated over.
The sequences do not have to be the same length, because they are
iterated over from left to right, <strong>not</strong> in parallel.  For each
element in <code class="docutils literal"><span class="pre">sequence1</span></code>, <code class="docutils literal"><span class="pre">sequence2</span></code> is looped over from the
beginning.  <code class="docutils literal"><span class="pre">sequence3</span></code>  is then looped over for each
resulting pair of elements from <code class="docutils literal"><span class="pre">sequence1</span></code> and <code class="docutils literal"><span class="pre">sequence2</span></code>.</p>
<p>To put it another way, a list comprehension or generator expression is
equivalent to the following Python code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">expr1</span> <span class="ow">in</span> <span class="n">sequence1</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">condition1</span><span class="p">):</span>
        <span class="k">continue</span>   <span class="c1"># Skip this element</span>
    <span class="k">for</span> <span class="n">expr2</span> <span class="ow">in</span> <span class="n">sequence2</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">condition2</span><span class="p">):</span>
            <span class="k">continue</span>    <span class="c1"># Skip this element</span>
        <span class="o">...</span>
        <span class="k">for</span> <span class="n">exprN</span> <span class="ow">in</span> <span class="n">sequenceN</span><span class="p">:</span>
             <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">conditionN</span><span class="p">):</span>
                 <span class="k">continue</span>   <span class="c1"># Skip this element</span>

             <span class="c1"># Output the value of</span>
             <span class="c1"># the expression.</span>
</pre></div>
</div>
<p>This means that when there are multiple <code class="docutils literal"><span class="pre">for...in</span></code> clauses but no
<code class="docutils literal"><span class="pre">if</span></code> clauses, the length of the resulting output will be equal to
the product of the lengths of all the sequences.  If you have two
lists of length 3, the output list is 9 elements long:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">seq1</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span>
<span class="n">seq2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seq1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">seq2</span><span class="p">]</span>
<span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
<p>To avoid introducing an ambiguity into Python&#8217;s grammar, if
<code class="docutils literal"><span class="pre">expression</span></code> is creating a tuple, it must be surrounded with
parentheses.  The first list comprehension below is a syntax error,
while the second one is correct:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Syntax error</span>
<span class="p">[</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seq1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">seq2</span><span class="p">]</span>
<span class="c1"># Correct</span>
<span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">seq1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">seq2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="generators">
<h2><a class="toc-backref" href="#id10">Generators</a><a class="headerlink" href="#generators" title="Permalink to this headline">¶</a></h2>
<p>Generators are a special class of functions that simplify the task of
writing iterators.  Regular functions compute a value and return it,
but generators return an iterator that returns a stream of values.</p>
<p>You&#8217;re doubtless familiar with how regular function calls work in
Python or C.  When you call a function, it gets a private namespace
where its local variables are created.  When the function reaches a
<code class="docutils literal"><span class="pre">return</span></code> statement, the local variables are destroyed and the
value is returned to the caller.  A later call to the same function
creates a new private namespace and a fresh set of local
variables. But, what if the local variables weren&#8217;t thrown away on
exiting a function?  What if you could later resume the function where
it left off?  This is what generators provide; they can be thought of
as resumable functions.</p>
<p>Here&#8217;s the simplest example of a generator function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_ints</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span>
</pre></div>
</div>
<p>Any function containing a <code class="docutils literal"><span class="pre">yield</span></code> keyword is a generator function;
this is detected by Python&#8217;s bytecode compiler which compiles the
function specially as a result.</p>
<p>When you call a generator function, it doesn&#8217;t return a single value;
instead it returns a generator object that supports the iterator
protocol.  On executing the <code class="docutils literal"><span class="pre">yield</span></code> expression, the generator
outputs the value of <code class="docutils literal"><span class="pre">i</span></code>, similar to a <code class="docutils literal"><span class="pre">return</span></code>
statement.  The big difference between <code class="docutils literal"><span class="pre">yield</span></code> and a
<code class="docutils literal"><span class="pre">return</span></code> statement is that on reaching a <code class="docutils literal"><span class="pre">yield</span></code> the
generator&#8217;s state of execution is suspended and local variables are
preserved.  On the next call to the generator&#8217;s <code class="docutils literal"><span class="pre">.next()</span></code> method,
the function will resume executing.</p>
<p>Here&#8217;s a sample usage of the <code class="docutils literal"><span class="pre">generate_ints()</span></code> generator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span> <span class="o">=</span> <span class="n">generate_ints</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span>
<span class="go">&lt;generator object at 0x8117f90&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;stdin&quot;</span>, line <span class="m">1</span>, in <span class="n">?</span>
  File <span class="nb">&quot;stdin&quot;</span>, line <span class="m">2</span>, in <span class="n">generate_ints</span>
<span class="gr">StopIteration</span>
</pre></div>
</div>
<p>You could equally write <code class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">generate_ints(5)</span></code>, or
<code class="docutils literal"><span class="pre">a,b,c</span> <span class="pre">=</span> <span class="pre">generate_ints(3)</span></code>.</p>
<p>Inside a generator function, the <code class="docutils literal"><span class="pre">return</span></code> statement can only be used
without a value, and signals the end of the procession of values;
after executing a <code class="docutils literal"><span class="pre">return</span></code> the generator cannot return any further
values.  <code class="docutils literal"><span class="pre">return</span></code> with a value, such as <code class="docutils literal"><span class="pre">return</span> <span class="pre">5</span></code>, is a syntax
error inside a generator function.  The end of the generator&#8217;s results
can also be indicated by raising <code class="docutils literal"><span class="pre">StopIteration</span></code> manually, or by
just letting the flow of execution fall off the bottom of the
function.</p>
<p>You could achieve the effect of generators manually by writing your
own class and storing all the local variables of the generator as
instance variables.  For example, returning a list of integers could
be done by setting <code class="docutils literal"><span class="pre">self.count</span></code> to 0, and having the
<code class="docutils literal"><span class="pre">next()</span></code> method increment <code class="docutils literal"><span class="pre">self.count</span></code> and return it.
However, for a moderately complicated generator, writing a
corresponding class can be much messier.</p>
<p>The test suite included with Python&#8217;s library, <code class="docutils literal"><span class="pre">test_generators.py</span></code>,
contains a number of more interesting examples.  Here&#8217;s one generator
that implements an in-order traversal of a tree using generators
recursively.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># A recursive generator that generates Tree leaves in in-order.</span>
<span class="k">def</span> <span class="nf">inorder</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inorder</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">x</span>

        <span class="k">yield</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inorder</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">right</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">x</span>
</pre></div>
</div>
<p>Two other examples in <code class="docutils literal"><span class="pre">test_generators.py</span></code> produce
solutions for the N-Queens problem (placing N queens on an NxN
chess board so that no queen threatens another) and the Knight&#8217;s Tour
(finding a route that takes a knight to every square of an NxN chessboard
without visiting any square twice).</p>
<div class="section" id="passing-values-into-a-generator">
<h3><a class="toc-backref" href="#id11">Passing values into a generator</a><a class="headerlink" href="#passing-values-into-a-generator" title="Permalink to this headline">¶</a></h3>
<p>In Python 2.4 and earlier, generators only produced output.  Once a
generator&#8217;s code was invoked to create an iterator, there was no way to
pass any new information into the function when its execution is
resumed.  You could hack together this ability by making the
generator look at a global variable or by passing in some mutable object
that callers then modify, but these approaches are messy.</p>
<p>In Python 2.5 there&#8217;s a simple way to pass values into a generator.
<code class="docutils literal"><span class="pre">yield</span></code> became an expression, returning a value that can be assigned
to a variable or otherwise operated on:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>I recommend that you <strong>always</strong> put parentheses around a <code class="docutils literal"><span class="pre">yield</span></code>
expression when you&#8217;re doing something with the returned value, as in
the above example.  The parentheses aren&#8217;t always necessary, but it&#8217;s
easier to always add them instead of having to remember when they&#8217;re
needed.</p>
<p>(PEP 342 explains the exact rules, which are that a
<code class="docutils literal"><span class="pre">yield</span></code>-expression must always be parenthesized except when it
occurs at the top-level expression on the right-hand side of an
assignment.  This means you can write <code class="docutils literal"><span class="pre">val</span> <span class="pre">=</span> <span class="pre">yield</span> <span class="pre">i</span></code> but have to
use parentheses when there&#8217;s an operation, as in <code class="docutils literal"><span class="pre">val</span> <span class="pre">=</span> <span class="pre">(yield</span> <span class="pre">i)</span>
<span class="pre">+</span> <span class="pre">12</span></code>.)</p>
<p>Values are sent into a generator by calling its
<code class="docutils literal"><span class="pre">send(value)</span></code> method.  This method resumes the
generator&#8217;s code and the <code class="docutils literal"><span class="pre">yield</span></code> expression returns the specified
value.  If the regular <code class="docutils literal"><span class="pre">next()</span></code> method is called, the
<code class="docutils literal"><span class="pre">yield</span></code> returns <code class="docutils literal"><span class="pre">None</span></code>.</p>
<p>Here&#8217;s a simple counter that increments by 1 and allows changing the
value of the internal counter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">counter</span> <span class="p">(</span><span class="n">maximum</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">maximum</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># If value provided, change counter</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>And here&#8217;s an example of changing the counter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt;&gt;&gt; it = counter(10)
&gt;&gt;&gt; print it.next()
0
&gt;&gt;&gt; print it.next()
1
&gt;&gt;&gt; print it.send(8)
8
&gt;&gt;&gt; print it.next()
9
&gt;&gt;&gt; print it.next()
Traceback (most recent call last):
  File ``t.py&#39;&#39;, line 15, in ?
    print it.next()
StopIteration
</pre></div>
</div>
<p>Because <code class="docutils literal"><span class="pre">yield</span></code> will often be returning <code class="docutils literal"><span class="pre">None</span></code>, you
should always check for this case.  Don&#8217;t just use its value in
expressions unless you&#8217;re sure that the <code class="docutils literal"><span class="pre">send()</span></code> method
will be the only method used resume your generator function.</p>
<p>In addition to <code class="docutils literal"><span class="pre">send()</span></code>, there are two other new methods on
generators:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">throw(type,</span> <span class="pre">value=None,</span> <span class="pre">traceback=None)</span></code> is used to raise an exception inside the
generator; the exception is raised by the <code class="docutils literal"><span class="pre">yield</span></code> expression
where the generator&#8217;s execution is paused.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">close()</span></code> raises a <code class="docutils literal"><span class="pre">GeneratorExit</span></code>
exception inside the generator to terminate the iteration.
On receiving this
exception, the generator&#8217;s code must either raise
<code class="docutils literal"><span class="pre">GeneratorExit</span></code> or <code class="docutils literal"><span class="pre">StopIteration</span></code>; catching the
exception and doing anything else is illegal and will trigger
a <code class="docutils literal"><span class="pre">RuntimeError</span></code>.  <code class="docutils literal"><span class="pre">close()</span></code> will also be called by
Python&#8217;s garbage collector when the generator is garbage-collected.</p>
<p>If you need to run cleanup code when a <code class="docutils literal"><span class="pre">GeneratorExit</span></code> occurs,
I suggest using a <code class="docutils literal"><span class="pre">try:</span> <span class="pre">...</span> <span class="pre">finally:</span></code> suite instead of
catching <code class="docutils literal"><span class="pre">GeneratorExit</span></code>.</p>
</li>
</ul>
<p>The cumulative effect of these changes is to turn generators from
one-way producers of information into both producers and consumers.</p>
<p>Generators also become <strong>coroutines</strong>, a more generalized form of
subroutines.  Subroutines are entered at one point and exited at
another point (the top of the function, and a <code class="docutils literal"><span class="pre">return</span></code>
statement), but coroutines can be entered, exited, and resumed at
many different points (the <code class="docutils literal"><span class="pre">yield</span></code> statements).</p>
</div>
</div>
<div class="section" id="built-in-functions">
<h2><a class="toc-backref" href="#id12">Built-in functions</a><a class="headerlink" href="#built-in-functions" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s look in more detail at built-in functions often used with iterators.</p>
<p>Two Python&#8217;s built-in functions, <code class="docutils literal"><span class="pre">map()</span></code> and <code class="docutils literal"><span class="pre">filter()</span></code>, are
somewhat obsolete; they duplicate the features of list comprehensions
but return actual lists instead of iterators.</p>
<p><code class="docutils literal"><span class="pre">map(f,</span> <span class="pre">iterA,</span> <span class="pre">iterB,</span> <span class="pre">...)</span></code> returns a list containing <code class="docutils literal"><span class="pre">f(iterA[0],</span>
<span class="pre">iterB[0]),</span> <span class="pre">f(iterA[1],</span> <span class="pre">iterB[1]),</span> <span class="pre">f(iterA[2],</span> <span class="pre">iterB[2]),</span> <span class="pre">...</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">upper</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="nb">map</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sentence&#39;</span><span class="p">,</span> <span class="s1">&#39;fragment&#39;</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="p">[</span><span class="s1">&#39;SENTENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;FRAGMENT&#39;</span><span class="p">]</span>

<span class="p">[</span><span class="n">upper</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sentence&#39;</span><span class="p">,</span> <span class="s1">&#39;fragment&#39;</span><span class="p">]]</span> <span class="o">=&gt;</span>
  <span class="p">[</span><span class="s1">&#39;SENTENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;FRAGMENT&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>As shown above, you can achieve the same effect with a list
comprehension.  The <code class="docutils literal"><span class="pre">itertools.imap()</span></code> function does the same thing
but can handle infinite iterators; it&#8217;ll be discussed later, in the section on
the <code class="docutils literal"><span class="pre">itertools</span></code> module.</p>
<p><code class="docutils literal"><span class="pre">filter(predicate,</span> <span class="pre">iter)</span></code> returns a list
that contains all the sequence elements that meet a certain condition,
and is similarly duplicated by list comprehensions.
A <strong>predicate</strong> is a function that returns the truth value of
some condition; for use with <code class="docutils literal"><span class="pre">filter()</span></code>, the predicate must take a
single value.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_even</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="nb">filter</span><span class="p">(</span><span class="n">is_even</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">=&gt;</span>
  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
<p>This can also be written as a list comprehension:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_even</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
<span class="go">[0, 2, 4, 6, 8]</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">filter()</span></code> also has a counterpart in the <code class="docutils literal"><span class="pre">itertools</span></code> module,
<code class="docutils literal"><span class="pre">itertools.ifilter()</span></code>, that returns an iterator and
can therefore handle infinite sequences just as <code class="docutils literal"><span class="pre">itertools.imap()</span></code> can.</p>
<p><code class="docutils literal"><span class="pre">reduce(func,</span> <span class="pre">iter,</span> <span class="pre">[initial_value])</span></code> doesn&#8217;t have a counterpart in
the <code class="docutils literal"><span class="pre">itertools</span></code> module because it cumulatively performs an operation
on all the iterable&#8217;s elements and therefore can&#8217;t be applied to
infinite iterables.  <code class="docutils literal"><span class="pre">func</span></code> must be a function that takes two elements
and returns a single value.  <code class="docutils literal"><span class="pre">reduce()</span></code> takes the first two elements
A and B returned by the iterator and calculates <code class="docutils literal"><span class="pre">func(A,</span> <span class="pre">B)</span></code>.  It
then requests the third element, C, calculates <code class="docutils literal"><span class="pre">func(func(A,</span> <span class="pre">B),</span>
<span class="pre">C)</span></code>, combines this result with the fourth element returned, and
continues until the iterable is exhausted.  If the iterable returns no
values at all, a <code class="docutils literal"><span class="pre">TypeError</span></code> exception is raised.  If the initial
value is supplied, it&#8217;s used as a starting point and
<code class="docutils literal"><span class="pre">func(initial_value,</span> <span class="pre">A)</span></code> is the first calculation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">operator</span>
<span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">concat</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;BB&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="s1">&#39;ABBC&#39;</span>
<span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">concat</span><span class="p">,</span> <span class="p">[])</span> <span class="o">=&gt;</span>
  <span class="ne">TypeError</span><span class="p">:</span> <span class="n">reduce</span><span class="p">()</span> <span class="n">of</span> <span class="n">empty</span> <span class="n">sequence</span> <span class="k">with</span> <span class="n">no</span> <span class="n">initial</span> <span class="n">value</span>
<span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">6</span>
<span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">1</span>
</pre></div>
</div>
<p>If you use <code class="docutils literal"><span class="pre">operator.add</span></code> with <code class="docutils literal"><span class="pre">reduce()</span></code>, you&#8217;ll add up all the
elements of the iterable.  This case is so common that there&#8217;s a special
built-in called <code class="docutils literal"><span class="pre">sum()</span></code> to compute it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">10</span>
<span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="mi">10</span>
<span class="nb">sum</span><span class="p">([])</span> <span class="o">=&gt;</span>
  <span class="mi">0</span>
</pre></div>
</div>
<p>For many uses of <code class="docutils literal"><span class="pre">reduce()</span></code>, though, it can be clearer to just write
the obvious <code class="docutils literal"><span class="pre">for</span></code> loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Instead of:</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># You can write:</span>
<span class="n">product</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
    <span class="n">product</span> <span class="o">*=</span> <span class="n">i</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">enumerate(iter)</span></code> counts off the elements in the iterable, returning
2-tuples containing the count and each element.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="s1">&#39;verb&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;subject&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;verb&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">enumerate()</span></code> is often used when looping through a list
and recording the indexes at which certain conditions are met:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Blank line at line #</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">sorted(iterable,</span> <span class="pre">[cmp=None],</span> <span class="pre">[key=None],</span> <span class="pre">[reverse=False)</span></code>
collects all the elements of the iterable into a list, sorts
the list, and returns the sorted result.  The <code class="docutils literal"><span class="pre">cmp</span></code>, <code class="docutils literal"><span class="pre">key</span></code>,
and <code class="docutils literal"><span class="pre">reverse</span></code> arguments are passed through to the
constructed list&#8217;s <code class="docutils literal"><span class="pre">.sort()</span></code> method.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="c1"># Generate 8 random numbers between [0, 10000)</span>
<span class="n">rand_list</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">rand_list</span> <span class="o">=&gt;</span>
  <span class="p">[</span><span class="mi">769</span><span class="p">,</span> <span class="mi">7953</span><span class="p">,</span> <span class="mi">9828</span><span class="p">,</span> <span class="mi">6431</span><span class="p">,</span> <span class="mi">8442</span><span class="p">,</span> <span class="mi">9878</span><span class="p">,</span> <span class="mi">6213</span><span class="p">,</span> <span class="mi">2207</span><span class="p">]</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">rand_list</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="p">[</span><span class="mi">769</span><span class="p">,</span> <span class="mi">2207</span><span class="p">,</span> <span class="mi">6213</span><span class="p">,</span> <span class="mi">6431</span><span class="p">,</span> <span class="mi">7953</span><span class="p">,</span> <span class="mi">8442</span><span class="p">,</span> <span class="mi">9828</span><span class="p">,</span> <span class="mi">9878</span><span class="p">]</span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">rand_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="p">[</span><span class="mi">9878</span><span class="p">,</span> <span class="mi">9828</span><span class="p">,</span> <span class="mi">8442</span><span class="p">,</span> <span class="mi">7953</span><span class="p">,</span> <span class="mi">6431</span><span class="p">,</span> <span class="mi">6213</span><span class="p">,</span> <span class="mi">2207</span><span class="p">,</span> <span class="mi">769</span><span class="p">]</span>
</pre></div>
</div>
<p>(For a more detailed discussion of sorting, see the Sorting mini-HOWTO
in the Python wiki at <a class="reference external" href="http://wiki.python.org/moin/HowTo/Sorting">http://wiki.python.org/moin/HowTo/Sorting</a>.)</p>
<p>The <code class="docutils literal"><span class="pre">any(iter)</span></code> and <code class="docutils literal"><span class="pre">all(iter)</span></code> built-ins look at
the truth values of an iterable&#8217;s contents.  <code class="docutils literal"><span class="pre">any()</span></code> returns
True if any element in the iterable is a true value, and <code class="docutils literal"><span class="pre">all()</span></code>
returns True if all of the elements are true values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">any</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="kc">True</span>
<span class="nb">any</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="kc">False</span>
<span class="nb">any</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="kc">True</span>
<span class="nb">all</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="kc">False</span>
<span class="nb">all</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="kc">False</span>
<span class="nb">all</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="small-functions-and-the-lambda-statement">
<h2><a class="toc-backref" href="#id13">Small functions and the lambda statement</a><a class="headerlink" href="#small-functions-and-the-lambda-statement" title="Permalink to this headline">¶</a></h2>
<p>When writing functional-style programs, you&#8217;ll often need little
functions that act as predicates or that combine elements in some way.</p>
<p>If there&#8217;s a Python built-in or a module function that&#8217;s suitable, you
don&#8217;t need to define a new function at all:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">stripped_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
<span class="n">existing_files</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">,</span> <span class="n">file_list</span><span class="p">)</span>
</pre></div>
</div>
<p>If the function you need doesn&#8217;t exist, you need to write it.  One way
to write small functions is to use the <code class="docutils literal"><span class="pre">lambda</span></code> statement.  <code class="docutils literal"><span class="pre">lambda</span></code>
takes a number of parameters and an expression combining these parameters,
and creates a small function that returns the value of the expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">lowercase</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">print_assign</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="n">adder</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
</pre></div>
</div>
<p>An alternative is to just use the <code class="docutils literal"><span class="pre">def</span></code> statement and define a
function in the usual way:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lowercase</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print_assign</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">adder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>Which alternative is preferable?  That&#8217;s a style question; my usual
course is to avoid using <code class="docutils literal"><span class="pre">lambda</span></code>.</p>
<p>One reason for my preference is that <code class="docutils literal"><span class="pre">lambda</span></code> is quite limited in
the functions it can define.  The result has to be computable as a
single expression, which means you can&#8217;t have multiway
<code class="docutils literal"><span class="pre">if...</span> <span class="pre">elif...</span> <span class="pre">else</span></code> comparisons or <code class="docutils literal"><span class="pre">try...</span> <span class="pre">except</span></code> statements.
If you try to do too much in a <code class="docutils literal"><span class="pre">lambda</span></code> statement, you&#8217;ll end up
with an overly complicated expression that&#8217;s hard to read.  Quick,
what&#8217;s the following code doing?</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">items</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>You can figure it out, but it takes time to disentangle the expression
to figure out what&#8217;s going on.  Using a short nested
<code class="docutils literal"><span class="pre">def</span></code> statements makes things a little bit better:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">combine</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">total</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">combine</span><span class="p">,</span> <span class="n">items</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>But it would be best of all if I had simply used a <code class="docutils literal"><span class="pre">for</span></code> loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">b</span>
</pre></div>
</div>
<p>Or the <code class="docutils literal"><span class="pre">sum()</span></code> built-in and a generator expression:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">items</span><span class="p">)</span>
</pre></div>
</div>
<p>Many uses of <code class="docutils literal"><span class="pre">reduce()</span></code> are clearer when written as <code class="docutils literal"><span class="pre">for</span></code> loops.</p>
<p>Fredrik Lundh once suggested the following set of rules for refactoring
uses of <code class="docutils literal"><span class="pre">lambda</span></code>:</p>
<ol class="arabic simple">
<li>Write a lambda function.</li>
<li>Write a comment explaining what the heck that lambda does.</li>
<li>Study the comment for a while, and think of a name that captures
the essence of the comment.</li>
<li>Convert the lambda to a def statement, using that name.</li>
<li>Remove the comment.</li>
</ol>
<p>I really like these rules, but you&#8217;re free to disagree that this
lambda-free style is better.</p>
</div>
<div class="section" id="the-itertools-module">
<h2><a class="toc-backref" href="#id14">The itertools module</a><a class="headerlink" href="#the-itertools-module" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">itertools</span></code> module contains a number of commonly-used iterators
as well as functions for combining several iterators.  This section
will introduce the module&#8217;s contents by showing small examples.</p>
<p>The module&#8217;s functions fall into a few broad classes:</p>
<ul class="simple">
<li>Functions that create a new iterator based on an existing iterator.</li>
<li>Functions for treating an iterator&#8217;s elements as function arguments.</li>
<li>Functions for selecting portions of an iterator&#8217;s output.</li>
<li>A function for grouping an iterator&#8217;s output.</li>
</ul>
<div class="section" id="creating-new-iterators">
<h3><a class="toc-backref" href="#id15">Creating new iterators</a><a class="headerlink" href="#creating-new-iterators" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">itertools.count(n)</span></code> returns an infinite stream of
integers, increasing by 1 each time.  You can optionally supply the
starting number, which defaults to 0:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">=&gt;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">...</span>
<span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.cycle(iter)</span></code> saves a copy of the contents of a provided
iterable and returns a new iterator that returns its elements from
first to last.  The new iterator will repeat these elements infinitely.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.repeat(elem,</span> <span class="pre">[n])</span></code> returns the provided element <code class="docutils literal"><span class="pre">n</span></code>
times, or returns the element endlessly if <code class="docutils literal"><span class="pre">n</span></code> is not provided.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="o">...</span>
<span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span><span class="p">,</span> <span class="n">abc</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.chain(iterA,</span> <span class="pre">iterB,</span> <span class="pre">...)</span></code> takes an arbitrary number of
iterables as input, and returns all the elements of the first
iterator, then all the elements of the second, and so on, until all of
the iterables have been exhausted.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">=&gt;</span>
  <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.izip(iterA,</span> <span class="pre">iterB,</span> <span class="pre">...)</span></code> takes one element from each iterable
and returns them in a tuple:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>It&#8217;s similiar to the built-in <code class="docutils literal"><span class="pre">zip()</span></code> function, but doesn&#8217;t
construct an in-memory list and exhaust all the input iterators before
returning; instead tuples are constructed and returned only if they&#8217;re
requested.  (The technical term for this behaviour is
<a class="reference external" href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazy evaluation</a>.)</p>
<p>This iterator is intended to be used with iterables that are all of
the same length.  If the iterables are of different lengths, the
resulting stream will be the same length as the shortest iterable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>You should avoid doing this, though, because an element may be taken
from the longer iterators and discarded.  This means you can&#8217;t go on
to use the iterators further because you risk skipping a discarded
element.</p>
<p><code class="docutils literal"><span class="pre">itertools.islice(iter,</span> <span class="pre">[start],</span> <span class="pre">stop,</span> <span class="pre">[step])</span></code> returns a stream
that&#8217;s a slice of the iterator.  With a single <code class="docutils literal"><span class="pre">stop</span></code> argument,
it will return the first <code class="docutils literal"><span class="pre">stop</span></code>
elements.  If you supply a starting index, you&#8217;ll get <code class="docutils literal"><span class="pre">stop-start</span></code>
elements, and if you supply a value for <code class="docutils literal"><span class="pre">step</span></code>, elements will be
skipped accordingly.  Unlike Python&#8217;s string and list slicing, you
can&#8217;t use negative values for <code class="docutils literal"><span class="pre">start</span></code>, <code class="docutils literal"><span class="pre">stop</span></code>, or <code class="docutils literal"><span class="pre">step</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
<span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
<span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.tee(iter,</span> <span class="pre">[n])</span></code> replicates an iterator; it returns <code class="docutils literal"><span class="pre">n</span></code>
independent iterators that will all return the contents of the source
iterator.  If you don&#8217;t supply a value for <code class="docutils literal"><span class="pre">n</span></code>, the default is 2.
Replicating iterators requires saving some of the contents of the source
iterator, so this can consume significant memory if the iterator is large
and one of the new iterators is consumed more than the others.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">tee</span><span class="p">(</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="p">)</span> <span class="o">=&gt;</span>
   <span class="n">iterA</span><span class="p">,</span> <span class="n">iterB</span>

<span class="n">where</span> <span class="n">iterA</span> <span class="o">-&gt;</span>
   <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">...</span>

<span class="ow">and</span>   <span class="n">iterB</span> <span class="o">-&gt;</span>
   <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="calling-functions-on-elements">
<h3><a class="toc-backref" href="#id16">Calling functions on elements</a><a class="headerlink" href="#calling-functions-on-elements" title="Permalink to this headline">¶</a></h3>
<p>Two functions are used for calling other functions on the contents of an
iterable.</p>
<p><code class="docutils literal"><span class="pre">itertools.imap(f,</span> <span class="pre">iterA,</span> <span class="pre">iterB,</span> <span class="pre">...)</span></code> returns
a stream containing <code class="docutils literal"><span class="pre">f(iterA[0],</span> <span class="pre">iterB[0]),</span> <span class="pre">f(iterA[1],</span> <span class="pre">iterB[1]),</span>
<span class="pre">f(iterA[2],</span> <span class="pre">iterB[2]),</span> <span class="pre">...</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">=&gt;</span>
  <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">operator</span></code> module contains a set of functions
corresponding to Python&#8217;s operators.  Some examples are
<code class="docutils literal"><span class="pre">operator.add(a,</span> <span class="pre">b)</span></code> (adds two values),
<code class="docutils literal"><span class="pre">operator.ne(a,</span> <span class="pre">b)</span></code> (same as <code class="docutils literal"><span class="pre">a!=b</span></code>),
and
<code class="docutils literal"><span class="pre">operator.attrgetter('id')</span></code> (returns a callable that
fetches the <code class="docutils literal"><span class="pre">&quot;id&quot;</span></code> attribute).</p>
<p><code class="docutils literal"><span class="pre">itertools.starmap(func,</span> <span class="pre">iter)</span></code> assumes that the iterable will
return a stream of tuples, and calls <code class="docutils literal"><span class="pre">f()</span></code> using these tuples as the
arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">,</span>
                  <span class="p">[(</span><span class="s1">&#39;/usr&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;/bin&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">),</span>
                   <span class="p">(</span><span class="s1">&#39;/usr&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;perl&#39;</span><span class="p">),(</span><span class="s1">&#39;/usr&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;ruby&#39;</span><span class="p">)])</span>
<span class="o">=&gt;</span>
  <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span><span class="p">,</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span><span class="p">,</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">perl</span><span class="p">,</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ruby</span>
</pre></div>
</div>
</div>
<div class="section" id="selecting-elements">
<h3><a class="toc-backref" href="#id17">Selecting elements</a><a class="headerlink" href="#selecting-elements" title="Permalink to this headline">¶</a></h3>
<p>Another group of functions chooses a subset of an iterator&#8217;s elements
based on a predicate.</p>
<p><code class="docutils literal"><span class="pre">itertools.ifilter(predicate,</span> <span class="pre">iter)</span></code> returns all the elements for
which the predicate returns true:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_even</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="n">itertools</span><span class="o">.</span><span class="n">ifilter</span><span class="p">(</span><span class="n">is_even</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">=&gt;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.ifilterfalse(predicate,</span> <span class="pre">iter)</span></code> is the opposite,
returning all elements for which the predicate returns false:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">ifilterfalse</span><span class="p">(</span><span class="n">is_even</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">=&gt;</span>
  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.takewhile(predicate,</span> <span class="pre">iter)</span></code> returns elements for as long
as the predicate returns true.  Once the predicate returns false,
the iterator will signal the end of its results.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">less_than_10</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">itertools</span><span class="o">.</span><span class="n">takewhile</span><span class="p">(</span><span class="n">less_than_10</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">=&gt;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span>

<span class="n">itertools</span><span class="o">.</span><span class="n">takewhile</span><span class="p">(</span><span class="n">is_even</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">=&gt;</span>
  <span class="mi">0</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">itertools.dropwhile(predicate,</span> <span class="pre">iter)</span></code> discards elements while the
predicate returns true, and then returns the rest of the iterable&#8217;s
results.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">itertools</span><span class="o">.</span><span class="n">dropwhile</span><span class="p">(</span><span class="n">less_than_10</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">=&gt;</span>
  <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="o">...</span>

<span class="n">itertools</span><span class="o">.</span><span class="n">dropwhile</span><span class="p">(</span><span class="n">is_even</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="o">=&gt;</span>
  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-elements">
<h3><a class="toc-backref" href="#id18">Grouping elements</a><a class="headerlink" href="#grouping-elements" title="Permalink to this headline">¶</a></h3>
<p>The last function I&#8217;ll discuss, <code class="docutils literal"><span class="pre">itertools.groupby(iter,</span>
<span class="pre">key_func=None)</span></code>, is the most complicated.  <code class="docutils literal"><span class="pre">key_func(elem)</span></code> is a
function that can compute a key value for each element returned by the
iterable.  If you don&#8217;t supply a key function, the key is simply each
element itself.</p>
<p><code class="docutils literal"><span class="pre">groupby()</span></code> collects all the consecutive elements from the
underlying iterable that have the same key value, and returns a stream
of 2-tuples containing a key value and an iterator for the elements
with that key.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">city_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Decatur&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Huntsville&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Selma&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Anchorage&#39;</span><span class="p">,</span> <span class="s1">&#39;AK&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Nome&#39;</span><span class="p">,</span> <span class="s1">&#39;AK&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;Flagstaff&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Phoenix&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Tucson&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">),</span>
             <span class="o">...</span>
            <span class="p">]</span>

<span class="k">def</span> <span class="nf">get_state</span> <span class="p">((</span><span class="n">city</span><span class="p">,</span> <span class="n">state</span><span class="p">)):</span>
    <span class="k">return</span> <span class="n">state</span>

<span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">city_list</span><span class="p">,</span> <span class="n">get_state</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;AL&#39;</span><span class="p">,</span> <span class="n">iterator</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
  <span class="p">(</span><span class="s1">&#39;AK&#39;</span><span class="p">,</span> <span class="n">iterator</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span>
  <span class="p">(</span><span class="s1">&#39;AZ&#39;</span><span class="p">,</span> <span class="n">iterator</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="o">...</span>

<span class="n">where</span>
<span class="n">iterator</span><span class="o">-</span><span class="mi">1</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;Decatur&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Huntsville&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Selma&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">)</span>
<span class="n">iterator</span><span class="o">-</span><span class="mi">2</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;Anchorage&#39;</span><span class="p">,</span> <span class="s1">&#39;AK&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Nome&#39;</span><span class="p">,</span> <span class="s1">&#39;AK&#39;</span><span class="p">)</span>
<span class="n">iterator</span><span class="o">-</span><span class="mi">3</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="s1">&#39;Flagstaff&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Phoenix&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Tucson&#39;</span><span class="p">,</span> <span class="s1">&#39;AZ&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">groupby()</span></code> assumes that the underlying iterable&#8217;s contents will
already be sorted based on the key.  Note that the returned iterators
also use the underlying iterable, so you have to consume the results
of iterator-1 before requesting iterator-2 and its corresponding key.</p>
</div>
</div>
<div class="section" id="the-functools-module">
<h2><a class="toc-backref" href="#id19">The functools module</a><a class="headerlink" href="#the-functools-module" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">functools</span></code> module in Python 2.5 contains some higher-order
functions.  A <strong>higher-order function</strong> takes one or more functions as
input and returns a new function.  The most useful tool in this module
is the <code class="docutils literal"><span class="pre">partial()</span></code> function.</p>
<p>For programs written in a functional style, you&#8217;ll sometimes want to
construct variants of existing functions that have some of the
parameters filled in.  Consider a Python function <code class="docutils literal"><span class="pre">f(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code>; you
may wish to create a new function <code class="docutils literal"><span class="pre">g(b,</span> <span class="pre">c)</span></code> that&#8217;s equivalent to
<code class="docutils literal"><span class="pre">f(1,</span> <span class="pre">b,</span> <span class="pre">c)</span></code>; you&#8217;re filling in a value for one of <code class="docutils literal"><span class="pre">f()</span></code>&#8216;s parameters.
This is called &#8220;partial function application&#8221;.</p>
<p>The constructor for <code class="docutils literal"><span class="pre">partial</span></code> takes the arguments <code class="docutils literal"><span class="pre">(function,</span> <span class="pre">arg1,</span>
<span class="pre">arg2,</span> <span class="pre">...</span> <span class="pre">kwarg1=value1,</span> <span class="pre">kwarg2=value2)</span></code>.  The resulting object is
callable, so you can just call it to invoke <code class="docutils literal"><span class="pre">function</span></code> with the
filled-in arguments.</p>
<p>Here&#8217;s a small but realistic example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>

<span class="k">def</span> <span class="nf">log</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">subsystem</span><span class="p">):</span>
    <span class="s2">&quot;Write the contents of &#39;message&#39; to the specified subsystem.&quot;</span>
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subsystem</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="o">...</span>

<span class="n">server_log</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">subsystem</span><span class="o">=</span><span class="s1">&#39;server&#39;</span><span class="p">)</span>
<span class="n">server_log</span><span class="p">(</span><span class="s1">&#39;Unable to open socket&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-operator-module">
<h2><a class="toc-backref" href="#id20">The operator module</a><a class="headerlink" href="#the-operator-module" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">operator</span></code> module was mentioned earlier.  It contains a set of
functions corresponding to Python&#8217;s operators.  These functions
are often useful in functional-style code because they save you
from writing trivial functions that perform a single operation.</p>
<p>Some of the functions in this module are:</p>
<ul class="simple">
<li>Math operations: <code class="docutils literal"><span class="pre">add()</span></code>, <code class="docutils literal"><span class="pre">sub()</span></code>, <code class="docutils literal"><span class="pre">mul()</span></code>, <code class="docutils literal"><span class="pre">div()</span></code>, <code class="docutils literal"><span class="pre">floordiv()</span></code>,
<code class="docutils literal"><span class="pre">abs()</span></code>, ...</li>
<li>Logical operations: <code class="docutils literal"><span class="pre">not_()</span></code>, <code class="docutils literal"><span class="pre">truth()</span></code>.</li>
<li>Bitwise operations: <code class="docutils literal"><span class="pre">and_()</span></code>, <code class="docutils literal"><span class="pre">or_()</span></code>, <code class="docutils literal"><span class="pre">invert()</span></code>.</li>
<li>Comparisons: <code class="docutils literal"><span class="pre">eq()</span></code>, <code class="docutils literal"><span class="pre">ne()</span></code>, <code class="docutils literal"><span class="pre">lt()</span></code>, <code class="docutils literal"><span class="pre">le()</span></code>, <code class="docutils literal"><span class="pre">gt()</span></code>, and <code class="docutils literal"><span class="pre">ge()</span></code>.</li>
<li>Object identity: <code class="docutils literal"><span class="pre">is_()</span></code>, <code class="docutils literal"><span class="pre">is_not()</span></code>.</li>
</ul>
<p>Consult <a class="reference external" href="http://docs.python.org/lib/module-operator.html">the operator module&#8217;s documentation</a> for a complete
list.</p>
</div>
<div class="section" id="the-functional-module">
<h2><a class="toc-backref" href="#id21">The functional module</a><a class="headerlink" href="#the-functional-module" title="Permalink to this headline">¶</a></h2>
<p>Collin Winter&#8217;s <a class="reference external" href="http://oakwinter.com/code/functional/">functional module</a>
provides a number of more
advanced tools for functional programming. It also reimplements
several Python built-ins, trying to make them more intuitive to those
used to functional programming in other languages.</p>
<p>This section contains an introduction to some of the most important
functions in <code class="docutils literal"><span class="pre">functional</span></code>; full documentation can be found at <a class="reference external" href="http://oakwinter.com/code/functional/documentation/">the
project&#8217;s website</a>.</p>
<p><code class="docutils literal"><span class="pre">compose(outer,</span> <span class="pre">inner,</span> <span class="pre">unpack=False)</span></code></p>
<p>The <code class="docutils literal"><span class="pre">compose()</span></code> function implements function composition.
In other words, it returns a wrapper around the <code class="docutils literal"><span class="pre">outer</span></code> and <code class="docutils literal"><span class="pre">inner</span></code> callables, such
that the return value from <code class="docutils literal"><span class="pre">inner</span></code> is fed directly to <code class="docutils literal"><span class="pre">outer</span></code>.  That is,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compose</span><span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">add</span><span class="p">)(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="go">22</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">double</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="go">22</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">unpack</span></code> keyword is provided to work around the fact that Python functions are not always
<a class="reference external" href="http://en.wikipedia.org/wiki/Currying">fully curried</a>.
By default, it is expected that the <code class="docutils literal"><span class="pre">inner</span></code> function will return a single object and that the <code class="docutils literal"><span class="pre">outer</span></code>
function will take a single argument. Setting the <code class="docutils literal"><span class="pre">unpack</span></code> argument causes <code class="docutils literal"><span class="pre">compose</span></code> to expect a
tuple from <code class="docutils literal"><span class="pre">inner</span></code> which will be expanded before being passed to <code class="docutils literal"><span class="pre">outer</span></code>. Put simply,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">compose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
<p>while</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">compose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">g</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
<p>Even though <code class="docutils literal"><span class="pre">compose()</span></code> only accepts two functions, it&#8217;s trivial to
build up a version that will compose any number of functions. We&#8217;ll
use <code class="docutils literal"><span class="pre">reduce()</span></code>, <code class="docutils literal"><span class="pre">compose()</span></code> and <code class="docutils literal"><span class="pre">partial()</span></code> (the last of which
is provided by both <code class="docutils literal"><span class="pre">functional</span></code> and <code class="docutils literal"><span class="pre">functools</span></code>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functional</span> <span class="k">import</span> <span class="n">compose</span><span class="p">,</span> <span class="n">partial</span>

<span class="n">multi_compose</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">reduce</span><span class="p">,</span> <span class="n">compose</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also use <code class="docutils literal"><span class="pre">map()</span></code>, <code class="docutils literal"><span class="pre">compose()</span></code> and <code class="docutils literal"><span class="pre">partial()</span></code> to craft a
version of <code class="docutils literal"><span class="pre">&quot;&quot;.join(...)</span></code> that converts its arguments to string:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functional</span> <span class="k">import</span> <span class="n">compose</span><span class="p">,</span> <span class="n">partial</span>

<span class="n">join</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">flip(func)</span></code></p>
<p><code class="docutils literal"><span class="pre">flip()</span></code> wraps the callable in <code class="docutils literal"><span class="pre">func</span></code> and
causes it to receive its non-keyword arguments in reverse order.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">triple</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">triple</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="go">(5, 6, 7)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flipped_triple</span> <span class="o">=</span> <span class="n">flip</span><span class="p">(</span><span class="n">triple</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">flipped_triple</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="go">(7, 6, 5)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">foldl(func,</span> <span class="pre">start,</span> <span class="pre">iterable)</span></code></p>
<p><code class="docutils literal"><span class="pre">foldl()</span></code> takes a binary function, a starting value (usually some kind of &#8216;zero&#8217;), and an iterable.
The function is applied to the starting value and the first element of the list, then the result of
that and the second element of the list, then the result of that and the third element of the list,
and so on.</p>
<p>This means that a call such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">foldl</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">foldl()</span></code> is roughly equivalent to the following recursive function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foldl</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">start</span>

    <span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
<p>Speaking of equivalence, the above <code class="docutils literal"><span class="pre">foldl</span></code> call can be expressed in terms of the built-in <code class="docutils literal"><span class="pre">reduce</span></code> like
so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">reduce</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We can use <code class="docutils literal"><span class="pre">foldl()</span></code>, <code class="docutils literal"><span class="pre">operator.concat()</span></code> and <code class="docutils literal"><span class="pre">partial()</span></code> to
write a cleaner, more aesthetically-pleasing version of Python&#8217;s
<code class="docutils literal"><span class="pre">&quot;&quot;.join(...)</span></code> idiom:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functional</span> <span class="k">import</span> <span class="n">foldl</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">concat</span>

<span class="n">join</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">foldl</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="revision-history-and-acknowledgements">
<h2><a class="toc-backref" href="#id22">Revision History and Acknowledgements</a><a class="headerlink" href="#revision-history-and-acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>The author would like to thank the following people for offering
suggestions, corrections and assistance with various drafts of this
article: Ian Bicking, Nick Coghlan, Nick Efford, Raymond Hettinger,
Jim Jewett, Mike Krell, Leandro Lameiro, Jussi Salmela,
Collin Winter, Blake Winton.</p>
<p>Version 0.1: posted June 30 2006.</p>
<p>Version 0.11: posted July 1 2006.  Typo fixes.</p>
<p>Version 0.2: posted July 10 2006.  Merged genexp and listcomp
sections into one.  Typo fixes.</p>
<p>Version 0.21: Added more references suggested on the tutor mailing list.</p>
<p>Version 0.30: Adds a section on the <code class="docutils literal"><span class="pre">functional</span></code> module written by
Collin Winter; adds short section on the operator module; a few other
edits.</p>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id23">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general">
<h3><a class="toc-backref" href="#id24">General</a><a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<p><strong>Structure and Interpretation of Computer Programs</strong>, by
Harold Abelson and Gerald Jay Sussman with Julie Sussman.
Full text at <a class="reference external" href="http://mitpress.mit.edu/sicp/">http://mitpress.mit.edu/sicp/</a>.
In this classic textbook of computer science,  chapters 2 and 3 discuss the
use of sequences and streams to organize the data flow inside a
program.  The book uses Scheme for its examples, but many of the
design approaches described in these chapters are applicable to
functional-style Python code.</p>
<p><a class="reference external" href="http://www.defmacro.org/ramblings/fp.html">http://www.defmacro.org/ramblings/fp.html</a>: A general
introduction to functional programming that uses Java examples
and has a lengthy historical introduction.</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Functional_programming">http://en.wikipedia.org/wiki/Functional_programming</a>:
General Wikipedia entry describing functional programming.</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Coroutine">http://en.wikipedia.org/wiki/Coroutine</a>:
Entry for coroutines.</p>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Currying">http://en.wikipedia.org/wiki/Currying</a>:
Entry for the concept of currying.</p>
</div>
<div class="section" id="python-specific">
<h3><a class="toc-backref" href="#id25">Python-specific</a><a class="headerlink" href="#python-specific" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://gnosis.cx/TPiP/">http://gnosis.cx/TPiP/</a>:
The first chapter of David Mertz&#8217;s book <cite>Text Processing in Python</cite>
discusses functional programming for text processing, in the section titled
&#8220;Utilizing Higher-Order Functions in Text Processing&#8221;.</p>
<p>Mertz also wrote a 3-part series of articles on functional programming
for IBM&#8217;s DeveloperWorks site; see
<a class="reference external" href="http://www-128.ibm.com/developerworks/library/l-prog.html">part 1</a>,
<a class="reference external" href="http://www-128.ibm.com/developerworks/library/l-prog2.html">part 2</a>, and
<a class="reference external" href="http://www-128.ibm.com/developerworks/linux/library/l-prog3.html">part 3</a>,</p>
</div>
<div class="section" id="python-documentation">
<h3><a class="toc-backref" href="#id26">Python documentation</a><a class="headerlink" href="#python-documentation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://docs.python.org/lib/module-itertools.html">http://docs.python.org/lib/module-itertools.html</a>:
Documentation for the <code class="docutils literal"><span class="pre">itertools</span></code> module.</p>
<p><a class="reference external" href="http://docs.python.org/lib/module-operator.html">http://docs.python.org/lib/module-operator.html</a>:
Documentation for the <code class="docutils literal"><span class="pre">operator</span></code> module.</p>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0289/">http://www.python.org/dev/peps/pep-0289/</a>:
PEP 289: &#8220;Generator Expressions&#8221;</p>
<p><a class="reference external" href="http://www.python.org/dev/peps/pep-0342/">http://www.python.org/dev/peps/pep-0342/</a>
PEP 342: &#8220;Coroutines via Enhanced Generators&#8221; describes the new generator
features in Python 2.5.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Gunter Hermann, Vincent Pohl, and Axel Schild.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'0.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>