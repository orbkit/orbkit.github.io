


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial for the Integration with Cubature &mdash; orbkit 0.2.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/orbkit.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="orbkit 0.2.2 documentation" href="../index.html"/>
        <link rel="up" title="Advanced Tutorials" href="index.html"/>
        <link rel="next" title="Tutorial for Processing Multiple Input Files" href="multiple_files.html"/>
        <link rel="prev" title="Tutorial for Atomic Population and Charge Analysis" href="atomic_populations.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> orbkit</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#instructions">Instructions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../general.html">General Aspects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general.html#requirements-for-the-input-files">Requirements for the Input Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general.html#capabilities">Capabilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quick.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quick.html#within-the-terminal">Within the Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quick.html#within-a-python-shell">Within a Python Shell</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gridbased/index.html">Grid-Based Calculation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gridbased/terminal.html">Usage via the Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gridbased/highlevel.html">orbkit&#8217;s High-Level Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gridbased/lowlevel.html">orbkit&#8217;s Low-Level Interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nongridbased/index.html">Non Grid-Based Calculation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../nongridbased/analytical.html">Analytical Integrals with orbkit</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="atomic_populations.html">Tutorial for Atomic Population and Charge Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Tutorial for the Integration with Cubature</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple_files.html">Tutorial for Processing Multiple Input Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="cclib.html">Tutorial for Input Processing with cclib</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../refs/index.html">Orbkit References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../refs/options.html">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../refs/cvars.html">Central Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../refs/funcref.html">Function Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../licence.html">Licence Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../impressum.html">Impressum - Legal Notice</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../impressum.html#impressum">Impressum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../impressum.html#haftungsausschluss-disclaimer">Haftungsausschluss - Disclaimer</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">orbkit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Advanced Tutorials</a> &raquo;</li>
      
    <li>Tutorial for the Integration with Cubature</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/adtutorials/cubature.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="tutorial-for-the-integration-with-cubature">
<h1>Tutorial for the Integration with Cubature<a class="headerlink" href="#tutorial-for-the-integration-with-cubature" title="Permalink to this headline">¶</a></h1>
<p>This is an advanced tutorial which shows how to use orbkit together with the
Python interface to Cubature to determine the norm of the occupied
molecular orbitals of the water molecule in a user-defined volume.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">References:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference external" href="http://ab-initio.mit.edu/wiki/index.php/Cubature">http://ab-initio.mit.edu/wiki/index.php/Cubature</a></li>
<li><a class="reference external" href="https://github.com/saullocastro/cubature">https://github.com/saullocastro/cubature</a> (Python interface)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>For simplicity, we use the molden file <tt class="docutils literal"><span class="pre">h2o.md</span></tt> as an example.
This file can be found in <tt class="docutils literal"><span class="pre">$ORBKITPATH/examples</span></tt>. Moreover, we assume that
you have followed the <a class="reference internal" href="../install.html#installation-instructions"><em>Installation</em></a> and that you have
installed the Python interface to <a class="reference external" href="https://github.com/saullocastro/cubature">cubature</a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">This tutorial explains a part of the example file
<tt class="docutils literal"><span class="pre">$ORBKITPATH/examples/interface_to_cubature.py</span></tt>.</p>
</div>
<div class="section" id="initialization-of-the-program">
<h2>Initialization of the Program<a class="headerlink" href="#initialization-of-the-program" title="Permalink to this headline">¶</a></h2>
<p>First, we have to import some modules and set some of orbkits options:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">cubature</span> <span class="kn">import</span> <span class="n">cubature</span>
<span class="kn">import</span> <span class="nn">orbkit</span>

<span class="c"># Disable orbkit terminal output for each run</span>
<span class="n">orbkit</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">quiet</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">orbkit</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_log</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># We initialize the grid for orbkit!</span>
<span class="n">orbkit</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">numproc</span> <span class="o">=</span> <span class="mi">4</span>             <span class="c">#: Specifies number of subprocesses.</span>
<span class="n">vector</span> <span class="o">=</span> <span class="mf">1e4</span>            <span class="c">#: Specifies number of points per subprocess.</span>
</pre></div>
</div>
<p>Then, we have to read the input file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Open molden file and read parameters</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">orbkit</span><span class="o">.</span><span class="n">main_read</span><span class="p">(</span><span class="s">&#39;h2o.md&#39;</span><span class="p">,</span><span class="n">itype</span><span class="o">=</span><span class="s">&#39;molden&#39;</span><span class="p">,</span><span class="n">all_mo</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-a-function-for-cubature">
<h2>Setting up a Function for Cubature<a class="headerlink" href="#setting-up-a-function-for-cubature" title="Permalink to this headline">¶</a></h2>
<p>Cubature requires a function with a special structure. It provides a 1d array
for the grid which we have bring into orbkit&#8217;s shape. Then, we have to call
orbkit&#8217;s main computational function <tt class="docutils literal"><span class="pre">orbkit.rho_compute</span></tt> with the respective
options, i.e., we compute the norm of all occupied molecular orbitals in this
example. Finally, we have to reshape orbkit&#8217;s output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x_array</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Calls orbkit.</span>

<span class="sd">  **Parameters:**</span>

<span class="sd">  x_array : 1-D numpy.ndarray, shape[0]=ndim*npt</span>
<span class="sd">    Contains the grid.</span>
<span class="sd">  args : tuple or list</span>
<span class="sd">    |args[0] : int</span>
<span class="sd">    |  Contains the number of points (npt).</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="c"># Set the grid</span>
  <span class="n">x_array</span> <span class="o">=</span> <span class="n">x_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
  <span class="n">orbkit</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">orbkit</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">orbkit</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_array</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

  <span class="c"># Compute the squared molecular orbitals with orbkit</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">orbkit</span><span class="o">.</span><span class="n">rho_compute</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span>
                           <span class="n">calc_mo</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
                           <span class="n">drv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">laplacian</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">numproc</span><span class="o">=</span><span class="n">numproc</span><span class="p">)</span>
  <span class="n">out</span> <span class="o">**=</span> <span class="mf">2.</span>

  <span class="c"># Return the results</span>
  <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">out</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We only consider the &#8220;vectorized&#8221; cubature which is much faster than the
single point cubature variant.</p>
</div>
</div>
<div class="section" id="run-cubature">
<h2>Run Cubature<a class="headerlink" href="#run-cubature" title="Permalink to this headline">¶</a></h2>
<p>We integrate in each dimension from -5 to 5 <img class="math" src="../_images/math/5be999261b3e82094d96c595dea3c22a9d6a036d.png" alt="{\rm a}_0"/> until we reach a
relative error of 1e-3 without considering the absolute error of the integral:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ndim</span> <span class="o">=</span> <span class="mi">3</span>                                      <span class="c">#: Number of dimensions being integrated</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">5.</span><span class="p">,</span><span class="o">-</span><span class="mf">5.</span><span class="p">,</span><span class="o">-</span><span class="mf">5.</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c">#: Minimum integration limit for each variable</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c">#: Maximum integration limit for each variable</span>
<span class="n">abserr</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c">#: Absolute error: |error| &lt; abserr (If zero, it will be ignored.)</span>
<span class="n">relerr</span> <span class="o">=</span> <span class="mf">1e-3</span> <span class="c">#: Relative error: |error| &lt; relerr*|integral| (If zero, it will be ignored.)</span>

<span class="c"># Call the cubature routine together with orbkit.</span>
<span class="n">integral_mo</span><span class="p">,</span><span class="n">error_mo</span> <span class="o">=</span> <span class="n">cubature</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                                <span class="n">adaptive</span><span class="o">=</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">abserr</span><span class="o">=</span><span class="n">abserr</span><span class="p">,</span> <span class="n">relerr</span><span class="o">=</span><span class="n">relerr</span><span class="p">,</span>
                                <span class="n">norm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxEval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vectorized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we can print the output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;The integral of...&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">inte</span><span class="p">,</span><span class="n">err</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">integral_mo</span><span class="p">,</span><span class="n">error_mo</span><span class="p">)):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">MO </span><span class="si">%s</span><span class="s"> is </span><span class="si">%.14f</span><span class="s">. (Error: </span><span class="si">%.4e</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">mo_spec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;sym&#39;</span><span class="p">],</span><span class="n">inte</span><span class="p">,</span><span class="n">err</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="multiple_files.html" class="btn btn-neutral float-right" title="Tutorial for Processing Multiple Input Files"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="atomic_populations.html" class="btn btn-neutral" title="Tutorial for Atomic Population and Charge Analysis"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Gunter Hermann, Vincent Pohl, and Axel Schild.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>